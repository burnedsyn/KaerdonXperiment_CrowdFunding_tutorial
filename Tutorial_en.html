<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Building a secure and trustworthy Web3 Crowdfunding Platform with QuickNode, Solidity, Orbis Protocol and Krebit protocol and reputation passport</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<p><link rel="stylesheet" href="./myStyle.css"></p>
<h1 id="building-a-secure-and-trustworthy-web3-crowdfunding-platform-with-quicknode-solidity-orbis-protocol-and-krebit-protocol-and-reputation-passport">Building a secure and trustworthy Web3 Crowdfunding Platform with QuickNode, Solidity, Orbis Protocol and Krebit protocol and reputation passport</h1>
<h4 id="vous-pouvez-aussi-lire-ce-tutoriel-en-français-ici-créer-une-plateforme-de-financement-participatif-web3-sécurisée-et-digne-de-confiance-avec-quicknode-solidity-le-protocol-orbis-le-passeport-de-réputation-et-le-protocol-krebit">vous pouvez aussi lire ce tutoriel en français ici: <a href="./Tutorial_fr.md" title="Version française">Créer une plateforme de financement participatif Web3 sécurisée et digne de confiance avec QuickNode, Solidity, le Protocol Orbis, le passeport de réputation et le protocol Krebit</a></h4>
<h2 id="introduction">Introduction</h2>
<p>Welcome to this tutorial on building a secure and trustworthy web3 crowdfunding platform using QuickNode, React, Solidity, the Orbis Protocol, and the krebit Protocol.</p>
<p>In this tutorial, you will learn how to create a full-fledged web3.0 application that allows users to send transactions through the blockchain to support crowdfunding campaigns. We will use React to build the frontend of the platform, and Solidity to write smart contracts on the Ethereum network that handle web3 functionality. To connect the platform to the Ethereum network, we will use QuickNode. Additionally, we will use the Orbis Protocol to add social features such as a newsfeed, messaging, and the ability to follow other users.</p>
<p>To ensure the security and reputation of our platform and its users, we will also be implementing the W3C Verifiable Credentials protocol by krebit.id and the krebit Reputation Passport. These tools will allow us to validate campaign creators and use verifiable credentials to ensure the integrity of our platform.</p>
<p>I am excited to guide you through using these tools and technologies to build a secure, trustworthy platform that also includes social features. Let’s get started on creating an amazing web3 crowdfunding platform together!</p>
<p><strong>I hope you’re as excited as I’m to get started on this tutorial! Let’s dive in and start building our web3 crowdfunding platform.</strong></p>
<h3 id="why-a-web3-crowdfunding-platform">Why a web3 crowdfunding platform?</h3>
<ul>
<li><p>Decentralization: Web3 platforms are decentralized, which means that they are not controlled by a single entity or authority. This can help to ensure that the platform is fair and transparent, as decisions are made through consensus rather than by a centralized authority.</p></li>
<li><p>Security: Web3 platforms can be more secure than traditional platforms, as they use blockchain technology to store and secure data. This can help to prevent fraud and tampering, which can be a concern with traditional platforms.</p></li>
<li><p>Accessibility: Web3 platforms can be accessed by anyone with an internet connection, which means that they can be used by a wider range of people than traditional platforms that may be limited to certain regions or countries.</p></li>
<li><p>Inclusivity: Web3 platforms can also be more inclusive, as they can allow users to participate using a variety of web3 payment methods such as cryptocurrencies. This can make it easier for people who may not have access to traditional financial services to participate in crowdfunding campaigns.</p></li>
<li><p>Transparency: Web3 platforms can also be more transparent, as they use blockchain technology to track and record transactions. This can make it easier for users to see how their donations are being used and can help to build trust within the community.</p></li>
</ul>
<h3 id="why-a-reputation-passport">Why a reputation passport?</h3>
<ul>
<li><p>Security: One of the main benefits of using a reputation passport is that it can help to ensure the security of the platform. By verifying the identity and reputation of campaign creators, users can have confidence that they are supporting legitimate campaigns and not falling victim to scams or fraud.</p></li>
<li><p>Trustworthiness: A reputation passport can also help to build trust within the community by allowing users to see the reputation and feedback of other users. This can help users make informed decisions about which campaigns to support and can encourage more people to participate in the platform.</p></li>
<li><p>Incentives: A reputation passport can also create incentives for campaign creators to behave ethically and maintain a good reputation. This can help to ensure that campaigns are run fairly and transparently, which can further enhance the trustworthiness of the platform.</p></li>
<li><p>Community: A web3 crowdfunding platform with social features can help to build a sense of community among users, which can be a valuable asset for both campaign creators and donors. By allowing users to connect with each other and discuss their campaigns, the platform can become a hub of activity and engagement.</p></li>
</ul>
<p><strong><em>Overall, building a web3 crowdfunding platform with a reputation passport can be a good thing because it can offer a decentralized, secure, accessible, inclusive, trustworthy, social and transparent environment for crowdfunding activities. This can help to make crowdfunding more efficient, effective, building confidence in the platform and encourage more people to participate, which can ultimately lead to more successful campaigns and a stronger community.</em></strong></p>
<h2 id="prerequisites">Prerequisites</h2>
<ol type="1">
<li><p>Basic understanding of web development concepts such as HTML, CSS, and JavaScript.</p></li>
<li><p>Experience with React: None as we start from scratch, but it may be helpful to have some familiarity with this framework.</p></li>
<li><p>Experience with Solidity: you may need some familiarity with this programming language.</p></li>
<li><p>Experience with the terminal: Some parts of the tutorial may involve using command line to install dependencies or run commands, so you may need some familiarity with it.</p></li>
</ol>
<h2 id="setting-up-your-development-environment">Setting up your development environment</h2>
<p>Before we get started, we need to set up our development environment.</p>
<h3 id="quicknode">QuickNode</h3>
<p>First, we will use QuickNode to spin up an Ethereum node with just a few clicks. This will give us access to the Ethereum evm and networks and all of its features.</p>
<p>QuickNode is a service that allows you to spin up a node in just a few clicks. It is a great way to get started with Ethereum development, as it allows you to quickly set up a node and start building your application without having to worry about setting up a node from scratch (which is ressource and time consuming). To create a node you need to register an account on QuickNode and then create a node for the network of your choice they can help you with at least 16 different blockchains at the time of writing this.</p>
<p>Boot your QuickNode in seconds and get access to 16+ different chains. Their globally distributed, auto-scaling, multi-cloud network will carry you from MVP all the way to enterprise. <a href="https://www.quicknode.com/signup" title="QuickNode">QuickNode signup</a></p>
<p>MVP stands for Minimum Viable Product. In this context, it refers to a stage in the development process where the product has the minimum set of features necessary</p>
<p>to be functional and can be used to test and validate the concept with potential customers. The idea is to get the product to market as quickly as possible in order to gather feedback and iterate on the product before investing too much time and resources</p>
<p>into development. The goal is to get the product to the point where it can be used to demonstrate its value and attract funding or customers.</p>
<h3 id="recommended-ide">Recommended IDE</h3>
<p>I recommend using VS Code as your IDE. It is a lightweight, open-source code editor that is easy to use and has a lot of useful features. It also has a lot of extensions that can help you with your development, such as Solidity and React.</p>
<h3 id="the-basic-structure-of-our-project">the basic structure of our project</h3>
<p>we will be using the following structure for our project: co we create the Crowdfunding_tutorial folder and inside it we create the client and web3 folders. The client folder will contain the frontend of our application, and the web3 folder will contain the smart contracts and the backend of our application.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">=&gt;</span> Crowdfunding_tutorial</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">=&gt;</span> client</a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">=&gt;</span> web3</a>
<a class="sourceLine" id="cb1-4" title="4">    </a></code></pre></div>
<h3 id="starting-the-app">starting the App</h3>
<p>open up the crowdfunding_tutorial folder in VS Code and open a new terminal.</p>
<figure>
<img src="./images/openwithvscode.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>in the terminal at the root level of your project, run the following command to create the smart contract of our application:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">npx</span> thirdweb@latest create --contract</a></code></pre></div>
<figure>
<img src="./images/npxthirdweb.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>and you can make different commands like this:</p>
<figure>
<img src="./images/npxthirdweb2.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>now we have some files in our web3 folder, let’s take a look at them:</p>
<figure>
<img src="./images/web3folder.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>You can start editing the page by modifying contracts/Contract.sol.</p>
<p>To add functionality to your contracts, you can use the <span class="citation" data-cites="thirdweb-dev/contracts">@thirdweb-dev/contracts</span> package which provides base contracts and extensions to inherit. Head to thirdweb <a href="https://portal.thirdweb.com/contractkit">Contracts Extensions Docs</a> to learn more.</p>
<p>as we need to manage sensible data in our smart contract, we will use the dotenv package to store our private key and mnemonic phrase in a .env file.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1">$ <span class="ex">npm</span> install dotenv</a></code></pre></div>
<figure>
<img src="./images/npminstalldotenv.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>we begin and rename the file contracts/Contract.sol to contracts/MyCrowdfunding.sol and we will start editing it.</p>
<p>we use <a href="https://docs.soliditylang.org/en/v0.8.17/introduction-to-smart-contracts.html">https://docs.soliditylang.org/en/v0.8.17/introduction-to-smart-contracts.html</a> as a reference for solidity.</p>
<h3 id="saving-some-gas">saving some gas</h3>
<p>And we have at heart that our users will be able to create campaigns, donate to campaigns, and withdraw funds from campaigns, without paying too much gas.</p>
<p>Because programming in solidity insn’t really like programming in other languages, we will start with the basics and then we will add more features to our smart contract. some parts of the code will be revisited later in the tutorial, for optimisation purpose. but one thing we can do now is thinking about the data structure we will need to store in our smart contract.</p>
<p>Because we will need to store the data of our campaigns, we need to create a structure, and we call it Campaign. and here is the first way where we can optimise our code, we will use what is call a tight packing, which means that we will use the smallest data type possible for each variable, and empile them in the right order to save gas for storagage data ONLY in memory packing data cost you more!</p>
<p>default slot length in solidty is 32 bytes, and the default unit of memory and storage is 32 bytes. in a 32 bytes slot we can save a uint256, which is the biggest integer type in solidity, but we can also save 8 uint32, 4 uint64, 2 uint128, or 1 uint256. Thus a uint8 is 1 byte, a uint16 is 2 bytes, a uint32 is 4 bytes, a uint64 is 8 bytes, a uint128 is 16 bytes, a uint160 is 20 bytes and a uint256 is 32 bytes.</p>
<p>Thinking a little about the value we have to store and the range they may have, will help us to take the fee as low as possible, this is also a valuable skill to have when you are programming in solidity.</p>
<h3 id="the-smart-contract">The smart contract</h3>
<p>we will start by declaring the version of solidity we will use, and the compiler version we will use to compile our smart contract. Next the first variable is an address it is the campaign owner. (or the admin of the platform if you want to think about it that way).</p>
<p>An address in solidity is a 20 bytes variable which is a uint160, it means that it will take 20 bytes of memory of storage in one slot of 32 bytes, as the base unit of memory and storage in solidity is 32 bytes. so the compiler can intelligently pack the data in the right order to save gas.</p>
<p>It does it by completing the 32 bytes slot with 0, so the address will take 20 bytes and the other 12 bytes will be 0 or we can use the 12 bytes to store another variables. and we will do that. simply by declaring the right type and packing them in the right order. saving space in storage in solidity is really important, because it will save gas for the user.</p>
<p>into the MyCrowdfunding.sol file we will add the following code:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="co">// SPDX-License-Identifier: GPL-3.0</span></a>
<a class="sourceLine" id="cb4-2" title="2">pragma solidity <span class="op">^</span><span class="dv">0</span>.<span class="fl">8.17</span><span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">/**</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co"> * </span><span class="an">@title</span><span class="co"> MyCrowdfunding</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co"> * </span><span class="an">@author</span><span class="co"> Timothee de Almeida &lt; [tim</span><span class="an">@1proamonservice.eu]</span><span class="co"> &gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"> * </span><span class="an">@dev</span><span class="co"> Implements crowdfunding platform</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="co"> * </span><span class="an">@dev</span><span class="co"> This contract is a simple crowdfunding platform where users can create campaigns and other users can donate to them.</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="co"> * </span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="co"> */</span></a>
<a class="sourceLine" id="cb4-11" title="11"></a>
<a class="sourceLine" id="cb4-12" title="12">contract MyCrowdfunding <span class="op">{</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="co">// platform owner address admin of the platform</span></a>
<a class="sourceLine" id="cb4-14" title="14">    address <span class="kw">public</span> platformOwner<span class="op">;</span></a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="op">}</span><span class="co">//end of contract</span></a></code></pre></div>
<h4 id="different-data-structures">different data structures</h4>
<p>Then we declare the backer data structure which will hold the data of the backers and donations of each crowdfunding campaign. and we tight pack the data in the right type and order to save gas.</p>
<p>As we know that the address is a uint160 which take 20 bytes of the 32 bytes of the current slot, we will declare the backer variable of type address, and the donation variable of type uint88, which is a uint of 88 bits so it make 11 bytes of memory or storage in one slot of 32 bytes. as a total of 31 bytes of memory or storage in one slot of 32 bytes. (we are sure that this structure will never take more than 31 bytes of memory or storage).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="co">// backer data structure</span></a>
<a class="sourceLine" id="cb5-2" title="2">    struct BackerData <span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">        address backer<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">        uint88 donation<span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="op">}</span></a></code></pre></div>
<p>Then we declare the campaign structure which will hold all the campaign data.</p>
<ul>
<li>The campaign owner variable will be of type address, and it will hold the address of the campaign owner.(20 bytes of 1 slot of 32 bytes).</li>
<li>An uint64 is enough to store a timestamp until the year 584,554AD so enough isn’t (8 bytes of 1 slot of 32 bytes).</li>
<li>status is a uint8 (255 possible values) so it is enough to store the status of the campaign (1 byte of 1 slot of 32 bytes).
<ul>
<li>0 - draft</li>
<li>1 - active</li>
<li>2 - completed</li>
<li>3 - cancelled</li>
<li>4 - withdrawn</li>
<li>5 - refunded campaign failed</li>
<li>6 - expired</li>
<li>7 - partial withdrawal</li>
</ul></li>
</ul>
<p>We have used only 1 slot of 32 bytes to store the 3 variables above. and we have 3 bytes left in this slot. So if needed later we could use this space to store another variables bool for example(1byte) or uint24(3bytes), etc.</p>
<ul>
<li><p>We use uint128 to store the target and amountCollected variables, which are enough to store a value of 340,282,366,920,938,463,463,374,607,431,768,211,455 (16 bytes of 1 slot of 32 bytes each).</p></li>
<li><p>we use a dynamic array of backersData structure to store the backers and donations of the campaign (32 bytes of 1 slot of 32 bytes). and 1 slot of 32 bytes for each line of backerData structure.</p></li>
</ul>
<p>The next three line are string variables, which are dynamic array of bytes, so they take 32 bytes of memory or storage in one slot of 32 bytes, and 1 slot of 32 bytes for each character of the string. so their size is not fixed, and we can’t really optimise them. hmm we will see it later but we can implement different ways to store these data in an efficient and optimised way. So string for title, description and imageUrl..</p>
<p>you can read about the differents types of variables in solidity here: <a href="https://docs.soliditylang.org/en/v0.8.17/types.html">https://docs.soliditylang.org/en/v0.8.17/types.html</a></p>
<p>so add the following code to the MyCrowdfunding.sol file below the backerData structure:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="co">// campaign structure which holds the campaign data</span></a>
<a class="sourceLine" id="cb6-2" title="2">    struct Campaign <span class="op">{</span></a>
<a class="sourceLine" id="cb6-3" title="3">        <span class="co">// campaign owner address (20 bytes of 1 slot of 32 bytes)</span></a>
<a class="sourceLine" id="cb6-4" title="4">        address owner<span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="co">// an uint64 is enough to store a timestamp until the year 584554 so it does take 8 bytes of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb6-6" title="6">        uint64 deadline<span class="op">;</span>  </a>
<a class="sourceLine" id="cb6-7" title="7">       <span class="co">// campaign status</span></a>
<a class="sourceLine" id="cb6-8" title="8">        <span class="co">// 0 - draft</span></a>
<a class="sourceLine" id="cb6-9" title="9">        <span class="co">// 1 - active</span></a>
<a class="sourceLine" id="cb6-10" title="10">        <span class="co">// 2 - completed</span></a>
<a class="sourceLine" id="cb6-11" title="11">        <span class="co">// 3 - cancelled</span></a>
<a class="sourceLine" id="cb6-12" title="12">        <span class="co">// 4 - withdrawn</span></a>
<a class="sourceLine" id="cb6-13" title="13">        <span class="co">// 5 - refunded</span></a>
<a class="sourceLine" id="cb6-14" title="14">        <span class="co">// 6 - expired</span></a>
<a class="sourceLine" id="cb6-15" title="15">        <span class="co">//a uint8 is enough to store a status code, it takes 1 byte of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb6-16" title="16">        uint8 status<span class="op">;</span></a>
<a class="sourceLine" id="cb6-17" title="17"></a>
<a class="sourceLine" id="cb6-18" title="18">        <span class="co">// here we have used 1 slot so far and we have 3 byte left in the slot to store another variable.</span></a>
<a class="sourceLine" id="cb6-19" title="19">        <span class="co">// we could use this space to store another variable bool for example(1byte) or uint24(3bytes), etc.  </span></a>
<a class="sourceLine" id="cb6-20" title="20">        bool mutex<span class="op">;</span></a>
<a class="sourceLine" id="cb6-21" title="21">        <span class="co">// target and amountCollected are uint128 enough to store a value of 340282366920938463463374607431768211455.</span></a>
<a class="sourceLine" id="cb6-22" title="22">        uint128 target<span class="op">;</span>        </a>
<a class="sourceLine" id="cb6-23" title="23">        uint128 amountCollected<span class="op">;</span></a>
<a class="sourceLine" id="cb6-24" title="24">        <span class="co">// from now we are using 1 slot or more per variable.</span></a>
<a class="sourceLine" id="cb6-25" title="25">        <span class="co">// backersData array is a dynamic array of BackerData structure    1 slot of 32 bytes for the array and 1 slot of 32 bytes for each line of BackerData structure.</span></a>
<a class="sourceLine" id="cb6-26" title="26">        BackerData[] backersData<span class="op">;</span></a>
<a class="sourceLine" id="cb6-27" title="27"></a>
<a class="sourceLine" id="cb6-28" title="28">        <span class="co">//these string are dynamic and will take more than 1 slot of 32 bytes each.</span></a>
<a class="sourceLine" id="cb6-29" title="29">        string image<span class="op">;</span></a>
<a class="sourceLine" id="cb6-30" title="30">        string title<span class="op">;</span></a>
<a class="sourceLine" id="cb6-31" title="31">        string description<span class="op">;</span>        </a>
<a class="sourceLine" id="cb6-32" title="32">    <span class="op">}</span></a></code></pre></div>
<p>we will see later how to optimise the storage of the string variables.</p>
<p>Then we declare the campaigns mapping which will hold all the campaigns of the platform, using numberOfCampaigns as index.</p>
<p>so we add the following code to the MyCrowdfunding.sol file below the Campaign structure:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">  <span class="co">// mapping of campaign IDs to campaign data</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> Campaign) <span class="kw">public</span> campaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="co">// number of campaigns</span></a>
<a class="sourceLine" id="cb7-5" title="5">    uint <span class="kw">public</span> numberOfCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb7-6" title="6">    </a></code></pre></div>
<h4 id="events">Events</h4>
<p>So now is a good time to talk about the events and how to use them. Events in solidity are a way to notify the blockchain that something has happened in the contract. and it can be used in front-end to listen to the event and do something when the event is triggered, like updating the UI with new data and the new state of the contract.</p>
<p>in our contract we will use events to notify the blockchain that a new campaign has been created or it’s status has been modified, or that a new donation has been made to a campaign.</p>
<p>So we will add the following code to the MyCrowdfunding.sol file below the campaigns mapping:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">// events</span></a>
<a class="sourceLine" id="cb8-3" title="3">    event <span class="at">CampaignCreated</span>(uint _campaignId<span class="op">,</span> address _owner<span class="op">,</span> uint _target<span class="op">,</span> uint _deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-4" title="4">    event <span class="at">CampaignStatusChanged</span>(uint _campaignId<span class="op">,</span> uint _status)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5">    event <span class="at">DonationReceived</span>(uint _campaignId<span class="op">,</span> address _backer<span class="op">,</span> uint _amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb8-6" title="6">   </a></code></pre></div>
<h4 id="customerrors">CustomErrors</h4>
<p>I recommand you to read this portion of the doc <a href="https://docs.soliditylang.org/en/v0.8.17/contracts.html#events" title="Events documentation">Events documentation</a> we will see later how to use the events in the front-end, and come back to this part of the code as we add others events in our contract.</p>
<p>Since solidity 0.8.4 we can use CustomErrors to throw errors in our contract, and it is a good practice to use them instead of the require function. It is a good practice to use CustomErrors because it is more gas efficient and it is easier to debug the contract. you’ll find more informations about custom errors here: <a href="https://docs.soliditylang.org/en/latest/control-structures.html#revert-statement" title="revert statement documentation">revert statement documentation</a></p>
<p>and <a href="https://docs.soliditylang.org/en/v0.8.17/contracts.html#index-16" title="error function documentation">error documentation</a> we declare a custom error called CustomError, and we will use it in our contract to throw errors.</p>
<p><strong>require(condition, “error message”) should be translated to if (!condition) revert CustomError().</strong></p>
<p>So we will add the following code to the MyCrowdfunding.sol file below the events declaration:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1">error <span class="at">Unauthorized</span>(address caller)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-2" title="2">error <span class="at">DeadlineError</span>(uint deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">error <span class="at">CampaignStatusError</span>(uint status)<span class="op">;</span></a></code></pre></div>
<h4 id="constructor">Constructor</h4>
<p>The constructor function is a special function that is executed only once when the contract is deployed. In our case we will use it to set the platformOwner variable to the address that deployed the contract.</p>
<p>Now we will add the constructor function to the MyCrowdfunding.sol file below the events declaration:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2"> <span class="co">//basic functions</span></a>
<a class="sourceLine" id="cb10-3" title="3">    <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-4" title="4">        platformOwner <span class="op">=</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">;</span></a>
<a class="sourceLine" id="cb10-5" title="5">        </a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="op">}</span></a></code></pre></div>
<h4 id="contract-functions">contract functions</h4>
<p>Now it’s time to add the functions that will be used in our contract to create a campaign, donate to a campaign, etc. we begin with the createCampaign function. function createCampaign (address _owner, string memory _title, string memory _description, uint256 _target, uint256 _deadline, string memory _image) public returns (uint256)</p>
<p>this function will be called by the campaign owner and will set a new campaign with all the data passed as parameters. these parameters will be stored in the campaigns they are declared as storage variables through the datastructure Campaign. we need the owner address, the title, description, target, deadline and image parameters because we need to store them in the campaign data. when we have set the data in the campaign structure we update the numberOfCampaigns variable and we emit the CampaignCreated event to notify the blockchain that a new campaign has been created. and return the id of the campaign (which is now the value of numberOfCampaigns-1). So we will add the following code to the MyCrowdfunding.sol file below the constructor function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="co">//@dev create a new campaign, will be called by the campaign owner and will be revisited later</span></a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="kw">function</span> <span class="at">createCampaign</span> (address _owner<span class="op">,</span> string memory _title<span class="op">,</span> string memory _description<span class="op">,</span> uint256 _target<span class="op">,</span> uint256 _deadline<span class="op">,</span> string memory _image)  <span class="kw">public</span> <span class="at">returns</span> (uint256) <span class="op">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">        Campaign storage campaign <span class="op">=</span> campaigns[numberOfCampaigns]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4">        <span class="co">// we have to use storage here because we are modifying the campaign data</span></a>
<a class="sourceLine" id="cb11-5" title="5">        <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb11-6" title="6">        <span class="cf">if</span>(_deadline <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(_deadline)<span class="op">;</span>        </a>
<a class="sourceLine" id="cb11-7" title="7">        <span class="va">campaign</span>.<span class="at">owner</span> <span class="op">=</span> _owner<span class="op">;</span></a>
<a class="sourceLine" id="cb11-8" title="8">        <span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">=</span> <span class="at">uint64</span>(_deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9">        <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-10" title="10">        <span class="va">campaign</span>.<span class="at">target</span> <span class="op">=</span> <span class="at">uint128</span>(_target)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-11" title="11">        <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-12" title="12">        <span class="va">campaign</span>.<span class="at">image</span> <span class="op">=</span> _image<span class="op">;</span></a>
<a class="sourceLine" id="cb11-13" title="13">        <span class="va">campaign</span>.<span class="at">title</span> <span class="op">=</span> _title<span class="op">;</span></a>
<a class="sourceLine" id="cb11-14" title="14">        <span class="va">campaign</span>.<span class="at">description</span> <span class="op">=</span>_description<span class="op">;</span>                               </a>
<a class="sourceLine" id="cb11-15" title="15">        numberOfCampaigns<span class="op">++;</span></a>
<a class="sourceLine" id="cb11-16" title="16">        emit <span class="at">CampaignCreated</span>(numberOfCampaigns<span class="dv">-1</span><span class="op">,</span> _owner<span class="op">,</span> _target<span class="op">,</span> _deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-17" title="17">        <span class="cf">return</span> numberOfCampaigns<span class="dv">-1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-18" title="18">    <span class="op">}</span></a></code></pre></div>
<p>Now we have a function to create a campaign, but we need a function to donate to a campaign too.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">function</span> <span class="at">donateToCampaign</span> (uint256 _id) <span class="kw">public</span> payable <span class="op">{</span></a>
<a class="sourceLine" id="cb12-3" title="3">      uint256 amount<span class="op">=</span> <span class="va">msg</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-4" title="4">      Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" title="5">      <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb12-6" title="6">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(<span class="va">campaign</span>.<span class="at">deadline</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-7" title="7">        <span class="co">// we check if the campaign is active if not we throw an error CampaignStatusError(uint status)</span></a>
<a class="sourceLine" id="cb12-8" title="8">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span> <span class="dv">1</span>) revert <span class="at">CampaignStatusError</span>(<span class="va">campaign</span>.<span class="at">status</span>)<span class="op">;</span>      </a>
<a class="sourceLine" id="cb12-9" title="9">          BackerData memory backerData <span class="op">=</span> <span class="at">BackerData</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb12-10" title="10">              <span class="dt">backer</span><span class="op">:</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-11" title="11">              <span class="dt">donation</span><span class="op">:</span> <span class="at">uint88</span>(amount)</a>
<a class="sourceLine" id="cb12-12" title="12">          <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-13" title="13">          <span class="va">campaign</span>.<span class="va">backersData</span>.<span class="at">push</span>(backerData)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-14" title="14">          <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="at">uint128</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">+</span>amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-15" title="15">          emit <span class="at">DonationReceived</span>(_id<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-16" title="16">          <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&gt;=</span> <span class="va">campaign</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-17" title="17">            <span class="co">// if the campaign has reached the target we change the status to 2</span></a>
<a class="sourceLine" id="cb12-18" title="18">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-19" title="19">            <span class="co">// we emit the CampaignStatusChanged event to notify the blockchain that the campaign status has been changed</span></a>
<a class="sourceLine" id="cb12-20" title="20">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-21" title="21">        <span class="op">}</span></a>
<a class="sourceLine" id="cb12-22" title="22">      </a>
<a class="sourceLine" id="cb12-23" title="23">    <span class="op">}</span></a></code></pre></div>
<p>we add the getCampaigns and getDonators functions to the contract into the MyCrowdfunding.sol file below the createCampaign function:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">function</span> <span class="at">getDonators</span> (uint256 _id) view <span class="kw">public</span> <span class="at">returns</span> (BackerData[] memory) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-3" title="3">      Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4">      <span class="cf">return</span> <span class="va">campaign</span>.<span class="at">backersData</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-5" title="5">    <span class="op">}</span></a>
<a class="sourceLine" id="cb13-6" title="6"></a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="kw">function</span> <span class="at">getCampaigns</span> () <span class="kw">public</span> view <span class="at">returns</span> (Campaign[] memory)  <span class="op">{</span></a>
<a class="sourceLine" id="cb13-8" title="8">        uint _numberOfCampaigns <span class="op">=</span> numberOfCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb13-9" title="9">        Campaign[] memory allCampaigns <span class="op">=</span> <span class="kw">new</span> Campaign[](_numberOfCampaigns)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-10" title="10">        <span class="cf">for</span> (uint i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>_numberOfCampaigns<span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-11" title="11">            Campaign storage item <span class="op">=</span> campaigns[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-12" title="12">            Campaign memory campaign <span class="op">=</span> <span class="at">Campaign</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb13-13" title="13">                <span class="dt">owner</span><span class="op">:</span> <span class="va">item</span>.<span class="at">owner</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-14" title="14">                <span class="dt">deadline</span><span class="op">:</span> <span class="va">item</span>.<span class="at">deadline</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-15" title="15">                <span class="dt">status</span><span class="op">:</span> <span class="va">item</span>.<span class="at">status</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-16" title="16">                <span class="dt">target</span><span class="op">:</span> <span class="va">item</span>.<span class="at">target</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-17" title="17">                <span class="dt">amountCollected</span><span class="op">:</span> <span class="va">item</span>.<span class="at">amountCollected</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-18" title="18">                <span class="dt">backersData</span><span class="op">:</span> <span class="va">item</span>.<span class="at">backersData</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-19" title="19">                <span class="dt">image</span><span class="op">:</span> <span class="va">item</span>.<span class="at">image</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-20" title="20">                <span class="dt">title</span><span class="op">:</span> <span class="va">item</span>.<span class="at">title</span><span class="op">,</span></a>
<a class="sourceLine" id="cb13-21" title="21">                <span class="dt">description</span><span class="op">:</span> <span class="va">item</span>.<span class="at">description</span></a>
<a class="sourceLine" id="cb13-22" title="22">            <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-23" title="23">            allCampaigns[i] <span class="op">=</span> campaign<span class="op">;</span></a>
<a class="sourceLine" id="cb13-24" title="24">        <span class="op">}</span></a>
<a class="sourceLine" id="cb13-25" title="25">        <span class="cf">return</span> allCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb13-26" title="26">    </a>
<a class="sourceLine" id="cb13-27" title="27">    <span class="op">}</span></a></code></pre></div>
<p>we now add a withdraw function to the contract this one will introduce some new concept and modify some sections previously written, in fact : we add to the campaign structure a new variable called mutex which will be used to prevent reentrancy attacks.</p>
<p>we add it in the campaign structure remember we have 3 byte left in the beginning of the struct there insert the bool mutex variable that 1 byte more in the slot and we need to add in the createCampaign function. as well as a new variables called amountWithdrawn that will be used to store the amount that had been withdrawn.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1">    struct Campaign <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">        <span class="co">// campaign owner address (20 bytes of 1 slot of 32 bytes)</span></a>
<a class="sourceLine" id="cb14-3" title="3">        address owner<span class="op">;</span></a>
<a class="sourceLine" id="cb14-4" title="4">        <span class="co">// an uint64 is enough to store a timestamp until the year 584554 so it does take 8 bytes of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb14-5" title="5">        uint64 deadline<span class="op">;</span>  </a>
<a class="sourceLine" id="cb14-6" title="6">       <span class="co">// campaign status</span></a>
<a class="sourceLine" id="cb14-7" title="7">        <span class="co">// 0 - draft</span></a>
<a class="sourceLine" id="cb14-8" title="8">        <span class="co">// 1 - active</span></a>
<a class="sourceLine" id="cb14-9" title="9">        <span class="co">// 2 - completed</span></a>
<a class="sourceLine" id="cb14-10" title="10">        <span class="co">// 3 - cancelled</span></a>
<a class="sourceLine" id="cb14-11" title="11">        <span class="co">// 4 - withdrawn</span></a>
<a class="sourceLine" id="cb14-12" title="12">        <span class="co">// 5 - refunded</span></a>
<a class="sourceLine" id="cb14-13" title="13">        <span class="co">// 6 - expired</span></a>
<a class="sourceLine" id="cb14-14" title="14">        <span class="co">//a uint8 is enough to store a status code, it takes 1 byte of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb14-15" title="15">        uint8 status<span class="op">;</span></a>
<a class="sourceLine" id="cb14-16" title="16"></a>
<a class="sourceLine" id="cb14-17" title="17">        <span class="co">// here we have used 1 slot so far and we have 3 byte left in the slot to store another variable.</span></a>
<a class="sourceLine" id="cb14-18" title="18">        <span class="co">// we could use this space to store another variable bool for example(1byte) or uint24(3bytes), etc. </span></a>
<a class="sourceLine" id="cb14-19" title="19">        <span class="co">// but we will use it to store a bool variable called mutex which will be used to prevent reentrancy attacks. </span></a>
<a class="sourceLine" id="cb14-20" title="20">        bool mutex<span class="op">;</span> </a>
<a class="sourceLine" id="cb14-21" title="21"></a>
<a class="sourceLine" id="cb14-22" title="22">        <span class="co">//this is 1 of 3 bytes left in the slot so 2 free bytes left</span></a>
<a class="sourceLine" id="cb14-23" title="23"></a>
<a class="sourceLine" id="cb14-24" title="24">        <span class="co">// target and amountCollected are uint128 enough to store a value of 340282366920938463463374607431768211455.</span></a>
<a class="sourceLine" id="cb14-25" title="25">        uint128 target<span class="op">;</span>        </a>
<a class="sourceLine" id="cb14-26" title="26">        uint128 amountCollected<span class="op">;</span></a>
<a class="sourceLine" id="cb14-27" title="27">        uint128 amountWithdrawn<span class="op">;</span></a></code></pre></div>
<p>this mean we have to modify the createCampaign function to add the mutex variable to the campaign structure. so add this line campaign.mutex = false; in the createCampaign function. below the campaign.status = 1; line. so it will look like this:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="co">//@dev create a new campaign, will be called by the campaign owner and will be revisited later</span></a>
<a class="sourceLine" id="cb15-2" title="2">    <span class="kw">function</span> <span class="at">createCampaign</span> (address _owner<span class="op">,</span> string memory _title<span class="op">,</span> string memory _description<span class="op">,</span> uint256 _target<span class="op">,</span> uint256 _deadline<span class="op">,</span> string memory _image)  <span class="kw">public</span> <span class="at">returns</span> (uint256) <span class="op">{</span></a>
<a class="sourceLine" id="cb15-3" title="3">        </a>
<a class="sourceLine" id="cb15-4" title="4">        <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb15-5" title="5">        <span class="cf">if</span>(_deadline <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(_deadline)<span class="op">;</span>    </a>
<a class="sourceLine" id="cb15-6" title="6">        Campaign storage campaign <span class="op">=</span> campaigns[numberOfCampaigns]<span class="op">;</span></a>
<a class="sourceLine" id="cb15-7" title="7">        <span class="co">// we have to use storage here because we are modifying the campaign data</span></a>
<a class="sourceLine" id="cb15-8" title="8">        <span class="va">campaign</span>.<span class="at">owner</span> <span class="op">=</span> _owner<span class="op">;</span></a>
<a class="sourceLine" id="cb15-9" title="9">        <span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">=</span> <span class="at">uint64</span>(_deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-10" title="10">        <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-11" title="11">        <span class="va">campaign</span>.<span class="at">mutex</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-12" title="12">        <span class="va">campaign</span>.<span class="at">target</span> <span class="op">=</span> <span class="at">uint128</span>(_target)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-13" title="13">        <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-14" title="14">        <span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-15" title="15">        <span class="va">campaign</span>.<span class="at">image</span> <span class="op">=</span> _image<span class="op">;</span></a>
<a class="sourceLine" id="cb15-16" title="16">        <span class="va">campaign</span>.<span class="at">title</span> <span class="op">=</span> _title<span class="op">;</span></a>
<a class="sourceLine" id="cb15-17" title="17">        <span class="va">campaign</span>.<span class="at">description</span> <span class="op">=</span>_description<span class="op">;</span>                               </a>
<a class="sourceLine" id="cb15-18" title="18">        numberOfCampaigns<span class="op">++;</span></a>
<a class="sourceLine" id="cb15-19" title="19">        emit <span class="at">CampaignCreated</span>(numberOfCampaigns<span class="dv">-1</span><span class="op">,</span> _owner<span class="op">,</span> _target<span class="op">,</span> _deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-20" title="20">        <span class="cf">return</span> numberOfCampaigns<span class="dv">-1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb15-21" title="21">    <span class="op">}</span></a></code></pre></div>
<p>we will also add a new event in the event section called Withdrawal to notify the blockchain that a withdrawal has been made.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1">event <span class="at">Withdrawal</span>(uint256 indexed _campaignId<span class="op">,</span> address indexed _owner<span class="op">,</span> uint256 _amount<span class="op">,</span> uint256 _timestamp)<span class="op">;</span></a></code></pre></div>
<p>we will also add these new errors to the contract in the error section.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1">    error <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb17-2" title="2">    error <span class="at">TransferError</span>(uint campaignId<span class="op">,</span> uint amount<span class="op">,</span> address recipient)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-3" title="3">    error <span class="at">InvalidWithdrawValue</span>(uint _request<span class="op">,</span> uint _available)<span class="op">;</span></a></code></pre></div>
<p>we have to alter the donate function to add the paritially withdrawn status to the campaign.status test in the beginning of the function. as with the withdraw function we will use a new status that is partially withdrawn to indicate that the campaign has been partially withdrawn. look at the if statement with campaign.status</p>
<p>so now the donateToCampaign functions will look like this:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">function</span> <span class="at">donateToCampaign</span> (uint256 _id) <span class="kw">public</span> payable <span class="op">{</span></a>
<a class="sourceLine" id="cb18-2" title="2">      uint256 amount<span class="op">=</span> <span class="va">msg</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb18-3" title="3">      Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb18-4" title="4">      <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb18-5" title="5">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(<span class="va">campaign</span>.<span class="at">deadline</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-6" title="6">        <span class="co">// we check if the campaign is active if not we throw an error CampaignStatusError(uint status)</span></a>
<a class="sourceLine" id="cb18-7" title="7">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span><span class="dv">7</span>) revert <span class="at">CampaignStatusError</span>(<span class="va">campaign</span>.<span class="at">status</span>)<span class="op">;</span>      </a>
<a class="sourceLine" id="cb18-8" title="8">          BackerData memory backerData <span class="op">=</span> <span class="at">BackerData</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb18-9" title="9">              <span class="dt">backer</span><span class="op">:</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span></a>
<a class="sourceLine" id="cb18-10" title="10">              <span class="dt">donation</span><span class="op">:</span> <span class="at">uint88</span>(amount)</a>
<a class="sourceLine" id="cb18-11" title="11">          <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-12" title="12">          <span class="va">campaign</span>.<span class="va">backersData</span>.<span class="at">push</span>(backerData)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-13" title="13">          <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="at">uint128</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">+</span>amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-14" title="14">          emit <span class="at">DonationReceived</span>(_id<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-15" title="15">          <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&gt;=</span> <span class="va">campaign</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb18-16" title="16">            <span class="co">// if the campaign has reached the target we change the status to 2</span></a>
<a class="sourceLine" id="cb18-17" title="17">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb18-18" title="18">            <span class="co">// we emit the CampaignStatusChanged event to notify the blockchain that the campaign status has been changed</span></a>
<a class="sourceLine" id="cb18-19" title="19">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb18-20" title="20">        <span class="op">}</span></a>
<a class="sourceLine" id="cb18-21" title="21">      </a>
<a class="sourceLine" id="cb18-22" title="22">    <span class="op">}</span></a></code></pre></div>
<p>we will add also a new status to the platform to indicate that the platform is in emergencyStop mode. in the beginning of the contract just below the platformowner address declaration we will add a new variable called _emergencyStop of type bool.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1"> </a>
<a class="sourceLine" id="cb19-2" title="2">bool <span class="kw">public</span> _emergencyStop<span class="op">;</span></a></code></pre></div>
<p>we will also add a new error to the contract in the error section.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb20-1" title="1">    error <span class="at">EmergencyMode</span>()<span class="op">;</span></a></code></pre></div>
<p>we will add an event to notify the blockchain that the emergencyStop mode has been changed.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb21-1" title="1">    event <span class="at">EmergencyStopChanged</span>(address indexed admin<span class="op">,</span> bool value<span class="op">,</span> uint timestamp)<span class="op">;</span></a></code></pre></div>
<p>we will add a new function to the contract to allow the platform owner to activate the emergencyStop mode.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1">         <span class="co">//@dev function to stop all actions on the platform</span></a>
<a class="sourceLine" id="cb22-2" title="2">        <span class="kw">function</span> <span class="at">emergencyStop</span>() <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb22-3" title="3">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb22-4" title="4">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner <span class="op">||</span>  emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">==</span> <span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb22-5" title="5">                _emergencyStop <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-6" title="6">            <span class="op">}</span></a>
<a class="sourceLine" id="cb22-7" title="7">        <span class="op">}</span></a></code></pre></div>
<p>we will also add a new function to the contract to allow the platform owner to resume normal operations on the platform. so we need to add a constant variable to the contract to set the minimum interval between two resume operations.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1">        uint constant MIN_RESUME_INTERVAL <span class="op">=</span> <span class="dv">5</span> minutes<span class="op">;</span></a></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1">        <span class="co">//@dev function to resume normal operations on the platform</span></a>
<a class="sourceLine" id="cb24-2" title="2">        <span class="kw">function</span> <span class="at">resume</span>() <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb24-3" title="3">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb24-4" title="4">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner <span class="op">||</span> emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">==</span> <span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb24-5" title="5">                <span class="co">// add a delay or lock-out period to prevent frequent or abusive use</span></a>
<a class="sourceLine" id="cb24-6" title="6">                <span class="cf">if</span> (<span class="va">block</span>.<span class="at">timestamp</span> <span class="op">&gt;</span> lastResumeTimestamp <span class="op">+</span> MIN_RESUME_INTERVAL) <span class="op">{</span></a>
<a class="sourceLine" id="cb24-7" title="7">                    _emergencyStop <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-8" title="8">                    lastResumeTimestamp <span class="op">=</span> <span class="va">block</span>.<span class="at">timestamp</span><span class="op">;</span></a>
<a class="sourceLine" id="cb24-9" title="9">                <span class="op">}</span></a>
<a class="sourceLine" id="cb24-10" title="10">            <span class="op">}</span></a>
<a class="sourceLine" id="cb24-11" title="11">        <span class="op">}</span></a></code></pre></div>
<p>we will also add a new function to the contract to allow the platform owner to add an emergency contact and one to remove it.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1">        <span class="co">//@dev function to add an address to the emergencyContacts mapping</span></a>
<a class="sourceLine" id="cb25-2" title="2">        <span class="kw">function</span> <span class="at">addEmergencyContact</span>(address _contact) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-3" title="3">            <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb25-4" title="4">            <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb25-5" title="5">            <span class="co">// only platform owner can call this function</span></a>
<a class="sourceLine" id="cb25-6" title="6">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-7" title="7">                emergencyContacts[_contact] <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb25-8" title="8">            <span class="op">}</span></a>
<a class="sourceLine" id="cb25-9" title="9">        <span class="op">}</span></a>
<a class="sourceLine" id="cb25-10" title="10">           <span class="co">//@dev function to remove an address to the emergencyContacts mapping</span></a>
<a class="sourceLine" id="cb25-11" title="11">        <span class="kw">function</span> <span class="at">removeEmergencyContact</span>(address _contact) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb25-12" title="12">            <span class="co">//we don&#39;t check if emergency mode is on in this case it could be better to let the owner remove an emergency contact even if the platform is in emergency mode, maybe this emergency contact is not available anymore or he is responsible of the emergency..</span></a>
<a class="sourceLine" id="cb25-13" title="13">            </a>
<a class="sourceLine" id="cb25-14" title="14">            <span class="co">// only platform owner can call this function</span></a>
<a class="sourceLine" id="cb25-15" title="15">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-16" title="16">                emergencyContacts[_contact] <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb25-17" title="17">            <span class="op">}</span></a>
<a class="sourceLine" id="cb25-18" title="18">        <span class="op">}</span></a></code></pre></div>
<p>Our user need a way to withdraw the funds from a campaign in multiple conditions and times.</p>
<p>We add a special mapping lastWithdrawalTimestamp in the mapping section of the contract.</p>
<p>This mapping will be used to store the last withdrawal timestamp that the owner of the campaign has made, so we use a mapping inside a mapping to store the timestamp of the last withdrawal for each campaign and each owner. we will add this mapping:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1"><span class="co">//last withdraw activity mapping(campaignId=&gt; mapping(address&quot;WHO&quot; =&gt; timestamps))</span></a>
<a class="sourceLine" id="cb26-2" title="2">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> <span class="at">mapping</span>(address <span class="kw">=&gt;</span> uint)) <span class="kw">public</span> lastWithdrawalTimestamp<span class="op">;</span></a></code></pre></div>
<p>into the MyCrowdfunding.sol file below the getCampaigns function:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1">  <span class="kw">function</span> <span class="at">withdraw</span>(uint256 _id<span class="op">,</span> uint256 _amount) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb27-2" title="2">        <span class="co">//we check if platform emergency mode is on</span></a>
<a class="sourceLine" id="cb27-3" title="3">        <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb27-4" title="4">        Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb27-5" title="5">        <span class="co">// we check the mutex lock for this campaign and verify if it is on</span></a>
<a class="sourceLine" id="cb27-6" title="6">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">mutex</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb27-7" title="7">        <span class="co">//we check if campaign emergency mode is on</span></a>
<a class="sourceLine" id="cb27-8" title="8">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span><span class="op">==</span><span class="dv">255</span>) revert <span class="at">EmergencyMode</span>()<span class="op">;</span>        </a>
<a class="sourceLine" id="cb27-9" title="9">        <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">owner</span> <span class="op">!=</span> <span class="va">msg</span>.<span class="at">sender</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-10" title="10">        uint _available<span class="op">=</span> <span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">-</span><span class="va">campaign</span>.<span class="at">amountWithdrawn</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-11" title="11">        </a>
<a class="sourceLine" id="cb27-12" title="12">        <span class="co">// Acquire the mutex lock for this campaign</span></a>
<a class="sourceLine" id="cb27-13" title="13">        <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span>       </a>
<a class="sourceLine" id="cb27-14" title="14">        uint status<span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-15" title="15">        <span class="cf">if</span> (status <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">7</span>) revert <span class="at">CampaignStatusError</span>(status)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-16" title="16">        <span class="cf">if</span> (_amount <span class="op">&gt;</span> _available) revert <span class="at">InvalidWithdrawValue</span>(_amount<span class="op">,</span>_available)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-17" title="17">        <span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">+=</span> <span class="at">uint128</span>(_amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-18" title="18">        <span class="co">// Transfer the Ether to the campaign owner</span></a>
<a class="sourceLine" id="cb27-19" title="19">        (bool success<span class="op">,</span> ) <span class="op">=</span> (<span class="va">msg</span>.<span class="at">sender</span>).<span class="at">call</span><span class="op">{</span><span class="dt">value</span><span class="op">:</span> _amount<span class="op">}</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-20" title="20">        <span class="cf">if</span> (<span class="op">!</span>success) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-21" title="21">        revert <span class="at">TransferError</span>(_id<span class="op">,</span> _amount<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-22" title="22">        <span class="op">}</span></a>
<a class="sourceLine" id="cb27-23" title="23">        emit <span class="at">Withdrawal</span>(_id<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> _amount<span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-24" title="24">        <span class="co">// If the campaign has been fully withdrawn but has not reached its target, set the campaign status to &quot;partially withdrawn 7&quot;</span></a>
<a class="sourceLine" id="cb27-25" title="25">        <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&lt;</span> <span class="va">campaign</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-26" title="26">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-27" title="27">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-28" title="28">        <span class="op">}</span> </a>
<a class="sourceLine" id="cb27-29" title="29">        <span class="co">// If the campaign has reached its target and all funds have been withdrawn, set the campaign status to &quot;withdrawn 4&quot;       </span></a>
<a class="sourceLine" id="cb27-30" title="30">        <span class="cf">else</span> <span class="cf">if</span> ( <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&gt;=</span> <span class="va">campaign</span>.<span class="at">target</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-31" title="31">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-32" title="32">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb27-33" title="33">        <span class="op">}</span></a>
<a class="sourceLine" id="cb27-34" title="34">        <span class="co">// Update the last withdrawal timestamp for this campaign and address</span></a>
<a class="sourceLine" id="cb27-35" title="35">        lastWithdrawalTimestamp[_id][<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">=</span> <span class="va">block</span>.<span class="at">timestamp</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-36" title="36">        <span class="co">// Release the mutex lock for this campaign</span></a>
<a class="sourceLine" id="cb27-37" title="37"></a>
<a class="sourceLine" id="cb27-38" title="38">        <span class="va">campaign</span>.<span class="at">mutex</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb27-39" title="39"></a>
<a class="sourceLine" id="cb27-40" title="40">        <span class="op">}</span> </a></code></pre></div>
<p>So there is some things to be said here :</p>
<ul>
<li><p>the withdraw function take 2 arguments the campaign id and the amount to withdraw.</p></li>
<li><p>first we check if emergency mode is on</p></li>
</ul>
<p>if(_emergencyStop) revert EmergencyMode();</p>
<ul>
<li>The function retrieve campaign data in a structure of type Campaign we use storage as we will modify it</li>
</ul>
<p>Campaign storage campaign = campaigns[_id];</p>
<ul>
<li>Then we check if the campaign emergency mode is on (different from platform emergency mode)</li>
</ul>
<p>if(campaign.status==255) revert EmergencyMode();</p>
<ul>
<li>Then it retrieve the value that is available to withdraw in a variable called _available by subtracting the amount collected from the amount withdrawn, this is to make sure that the owner of the campaign can’t withdraw more than what is available, and doing it before the lock is acquired prevent race condition.</li>
</ul>
<p>uint _available= campaign.amountCollected-campaign.amountWithdrawn;</p>
<ul>
<li>Then it acquire the mutex lock for this campaign and verify if it is on if it is it will throw an error LockError()</li>
</ul>
<p>if(campaign.mutex) revert LockError(); and then it set the mutex to true to lock the campaign campaign.mutex=true;</p>
<ul>
<li>Then it check if the caller is the owner of the campaign if not it will throw an error Unauthorized(address)</li>
</ul>
<p>if (campaign.owner != msg.sender) revert Unauthorized(msg.sender);</p>
<ul>
<li>Then it check if the campaign status is 1,2 or 7 if not it will throw an error CampaignStatusError(uint)</li>
</ul>
<p>if (status != 1 &amp;&amp; status != 2 &amp;&amp; status != 7) revert CampaignStatusError(status);</p>
<ul>
<li>Then it check if the amount to withdraw is greater than the available amount if it is it will throw an error InvalidWithdrawValue(_amount,_available)</li>
</ul>
<p>if (_amount &gt; _available) revert InvalidWithdrawValue(_amount,_available);</p>
<ul>
<li>Then it add the amount to withdraw to the amount withdrawn in the campaign structure</li>
</ul>
<p>campaign.amountWithdrawn += uint128(_amount);</p>
<ul>
<li>Then it try to transfer the amount to the owner of the campaign if it fails it will throw an error TransferError(uint campaignId,uint amount,address msg.sender)</li>
</ul>
<p>// Transfer the Ether to the campaign owner</p>
<pre><code>    (bool success, ) = (msg.sender).call{value: _amount}(&quot;&quot;);

    if (!success) {
    revert TransferError(_id, _amount, msg.sender);
    }</code></pre>
<ul>
<li>Then it emit the Withdrawal event to notify the blockchain that a withdrawal has been made</li>
</ul>
<p>emit Withdrawal(_id, msg.sender, _amount, block.timestamp);</p>
<ul>
<li>Then it check if the campaign status is not 7 and the amount withdrawn is less than the target if it is it will change the status to 7 and emit the CampaignStatusChanged event to notify the blockchain that the status has been changed 7 is partially withdrawn</li>
</ul>
<p>if (campaign.amountWithdrawn == campaign.amountCollected &amp;&amp; campaign.amountCollected &lt; campaign.target) { campaign.status = 7; emit CampaignStatusChanged(_id, 7); }</p>
<ul>
<li><p>Then it check if the amount collected is greater than or equal to the target and the amount withdrawn is equal to the amount collected if it is it will change the status to 4 and emit the CampaignStatusChanged event to notify the blockchain that the status has been changed 4 is withdrawn and 7 is partially withdrawn</p>
<p>else if ( campaign.amountCollected &gt;= campaign.target &amp;&amp; campaign.amountWithdrawn == campaign.amountCollected) { campaign.status = 4; emit CampaignStatusChanged(_id, 4); }</p></li>
<li><p>Update the last withdrawal timestamp for this campaign and address</p></li>
</ul>
<p>lastWithdrawalTimestamp[_id][msg.sender] = block.timestamp;</p>
<ul>
<li>The last thing it does is releasing the mutex lock for this campaign.</li>
</ul>
<p>campaign.mutex = false; }</p>
<p>This close the withdraw function, we will now add some functions and events verify in the complete code as nothing new to the contract to make it more usable and safe.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1">         <span class="co">//@dev function to stop normal operations on the campaign</span></a>
<a class="sourceLine" id="cb29-2" title="2">        <span class="kw">function</span> <span class="at">setCampaignEmergencyStop</span> (uint _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-3" title="3">            <span class="co">//we didn&#39;t check if platform emergency mode is on because admin may have to set emergency stop on campaign to resume normal platform operation</span></a>
<a class="sourceLine" id="cb29-4" title="4">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-5" title="5">            <span class="co">//we check if msg.sender is platformOwner or emergencyContacts</span></a>
<a class="sourceLine" id="cb29-6" title="6">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&amp;&amp;</span> <span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> <span class="va">campaign</span>.<span class="at">owner</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-7" title="7">           </a>
<a class="sourceLine" id="cb29-8" title="8">            </a>
<a class="sourceLine" id="cb29-9" title="9">            <span class="co">//we set the campaign status to 255 it is the panic mode emergency stop value of status if yes we revert no need to set already set</span></a>
<a class="sourceLine" id="cb29-10" title="10">            <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">==</span> <span class="dv">255</span>) revert <span class="at">CampaignEmergencyMode</span>(<span class="st">&quot;campaign already in emergency mode&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-11" title="11">            <span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-12" title="12">            <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="dv">255</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-13" title="13">            emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-14" title="14">        <span class="op">}</span></a>
<a class="sourceLine" id="cb29-15" title="15">         <span class="co">//@dev function to resume normal operations on the campaign</span></a>
<a class="sourceLine" id="cb29-16" title="16">        <span class="kw">function</span> <span class="at">campaignResume</span>(uint _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-17" title="17">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb29-18" title="18">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>]) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-19" title="19">            <span class="co">//we set the campaign back to backupstate it is the panic mode emergency OFF  status</span></a>
<a class="sourceLine" id="cb29-20" title="20">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-21" title="21">             <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span> <span class="dv">255</span>) revert <span class="at">CampaignEmergencyMode</span>(<span class="st">&quot;campaign not in emergency mode&quot;</span>)<span class="op">;</span>            </a>
<a class="sourceLine" id="cb29-22" title="22">            <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">;</span>   </a>
<a class="sourceLine" id="cb29-23" title="23">            emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span>         </a>
<a class="sourceLine" id="cb29-24" title="24">        <span class="op">}</span></a>
<a class="sourceLine" id="cb29-25" title="25"></a>
<a class="sourceLine" id="cb29-26" title="26"></a>
<a class="sourceLine" id="cb29-27" title="27">        <span class="kw">function</span> <span class="at">cancelCampaign</span>(uint256 _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-28" title="28">            <span class="co">// Get the campaign data</span></a>
<a class="sourceLine" id="cb29-29" title="29">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-30" title="30">            <span class="co">// Check that the caller is a platform admin or the campaign owner</span></a>
<a class="sourceLine" id="cb29-31" title="31">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&amp;&amp;</span>  <span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> <span class="va">campaign</span>.<span class="at">owner</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-32" title="32">            </a>
<a class="sourceLine" id="cb29-33" title="33">            <span class="co">// Check that the campaign is still active or partial withdrawn or emergency stop mode</span></a>
<a class="sourceLine" id="cb29-34" title="34">            uint status<span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-35" title="35">            <span class="cf">if</span> (status <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">7</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">255</span>) revert <span class="at">CampaignStatusError</span>(status)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-36" title="36">            <span class="co">//we restrict if campaign.owner == msg.sender</span></a>
<a class="sourceLine" id="cb29-37" title="37">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span><span class="op">==</span><span class="va">campaign</span>.<span class="at">owner</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-38" title="38">                <span class="cf">if</span> (status<span class="op">==</span><span class="dv">255</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-39" title="39">                    emit <span class="at">CancelPending</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-40" title="40">                   <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb29-41" title="41">                <span class="op">}</span></a>
<a class="sourceLine" id="cb29-42" title="42">                <span class="cf">if</span>(status<span class="op">==</span><span class="dv">7</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb29-43" title="43">                    <span class="cf">if</span>(lastWithdrawalTimestamp[_campaignId][<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&gt;</span> <span class="va">block</span>.<span class="at">timestamp</span> <span class="op">-</span> MIN_CANCEL_INTERVAL)<span class="op">{</span></a>
<a class="sourceLine" id="cb29-44" title="44">                        emit <span class="at">SpeedCancelAlert</span>(_campaignId<span class="op">,</span><span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span><span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-45" title="45">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb29-46" title="46">                    <span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-47" title="47">                    <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="dv">255</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-48" title="48">                    emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-49" title="49">                    emit <span class="at">CancelPending</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-50" title="50">                    <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb29-51" title="51">                <span class="op">}</span></a>
<a class="sourceLine" id="cb29-52" title="52">            <span class="op">}</span></a>
<a class="sourceLine" id="cb29-53" title="53">            </a>
<a class="sourceLine" id="cb29-54" title="54">            <span class="co">// Set the campaign status to &quot;cancelled&quot;</span></a>
<a class="sourceLine" id="cb29-55" title="55">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-56" title="56">            <span class="co">// Emit an event to record the change in status</span></a>
<a class="sourceLine" id="cb29-57" title="57">            emit <span class="at">CampaignStatusChanged</span>(_campaignId<span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-58" title="58">            <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb29-59" title="59">        <span class="op">}</span></a>
<a class="sourceLine" id="cb29-60" title="60"></a>
<a class="sourceLine" id="cb29-61" title="61">        <span class="kw">function</span> <span class="at">partialRefund</span>(uint campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-62" title="62"></a>
<a class="sourceLine" id="cb29-63" title="63">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb29-64" title="64">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>]) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-65" title="65">            Campaign storage campaign <span class="op">=</span> campaigns[campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-66" title="66">            <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span>) <span class="op">{</span>               </a>
<a class="sourceLine" id="cb29-67" title="67">                <span class="cf">return</span><span class="op">;</span> <span class="co">// nothing to do</span></a>
<a class="sourceLine" id="cb29-68" title="68">            <span class="op">}</span></a>
<a class="sourceLine" id="cb29-69" title="69"></a>
<a class="sourceLine" id="cb29-70" title="70">            uint refundAmount <span class="op">=</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">-</span> <span class="va">campaign</span>.<span class="at">amountWithdrawn</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-71" title="71">            uint percentage <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> refundAmount / <span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-72" title="72">            uint tmp<span class="op">=</span><span class="va">campaign</span>.<span class="va">backersData</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-73" title="73">            <span class="co">// we check the mutex lock for this campaign and verify if it is on</span></a>
<a class="sourceLine" id="cb29-74" title="74">            <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">mutex</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb29-75" title="75">            <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-76" title="76">            <span class="co">//we give property of the refundamount to backers through this mapping </span></a>
<a class="sourceLine" id="cb29-77" title="77">            <span class="cf">for</span> (uint i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> tmp<span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-78" title="78">                BackerData storage backer <span class="op">=</span> <span class="va">campaign</span>.<span class="at">backersData</span>[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-79" title="79">                uint backerRefundAmount <span class="op">=</span> <span class="va">backer</span>.<span class="at">donation</span> <span class="op">*</span> percentage / <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-80" title="80">                BackerRefund memory refundprocess <span class="op">=</span> <span class="at">BackerRefund</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb29-81" title="81">              <span class="dt">locked</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-82" title="82">              <span class="dt">refundAmount</span><span class="op">:</span> <span class="at">uint128</span>(backerRefundAmount)</a>
<a class="sourceLine" id="cb29-83" title="83">          <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-84" title="84">                partialRefundWaiting[campaignId][<span class="va">backer</span>.<span class="at">backer</span>]<span class="op">=</span>refundprocess<span class="op">;</span></a>
<a class="sourceLine" id="cb29-85" title="85">                <span class="va">backer</span>.<span class="at">donation</span> <span class="op">-=</span> <span class="at">uint88</span>(backerRefundAmount)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-86" title="86">                emit <span class="at">PartialRefundWaitingNotification</span>(campaignId<span class="op">,</span> <span class="va">backer</span>.<span class="at">backer</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span>                </a>
<a class="sourceLine" id="cb29-87" title="87">            <span class="op">}</span></a>
<a class="sourceLine" id="cb29-88" title="88">            <span class="co">// we substract the refundAmount from the collectedAmount</span></a>
<a class="sourceLine" id="cb29-89" title="89">            <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">-=</span> <span class="at">uint128</span>(refundAmount)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-90" title="90">            emit <span class="at">CampaignPartialRefundInitiated</span>(campaignId<span class="op">,</span><span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-91" title="91">            <span class="co">// we free the mutex</span></a>
<a class="sourceLine" id="cb29-92" title="92">            <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-93" title="93"></a>
<a class="sourceLine" id="cb29-94" title="94">        <span class="op">}</span></a>
<a class="sourceLine" id="cb29-95" title="95"></a>
<a class="sourceLine" id="cb29-96" title="96">        <span class="kw">function</span> <span class="at">backerRefundWithdraw</span>(uint campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb29-97" title="97">            <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb29-98" title="98">            <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb29-99" title="99">            BackerRefund storage refundprocess <span class="op">=</span> partialRefundWaiting[campaignId][<span class="va">msg</span>.<span class="at">sender</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-100" title="100">            <span class="cf">if</span>(<span class="va">refundprocess</span>.<span class="at">locked</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb29-101" title="101">            <span class="va">refundprocess</span>.<span class="at">locked</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-102" title="102">            <span class="cf">if</span> ( <span class="va">refundprocess</span>.<span class="at">refundAmount</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-103" title="103">                uint _amount<span class="op">=</span><span class="va">refundprocess</span>.<span class="at">refundAmount</span><span class="op">;</span></a>
<a class="sourceLine" id="cb29-104" title="104">                <span class="co">// Transfer the Ether to the campaign owner</span></a>
<a class="sourceLine" id="cb29-105" title="105">                (bool success<span class="op">,</span> ) <span class="op">=</span> (<span class="va">msg</span>.<span class="at">sender</span>).<span class="at">call</span><span class="op">{</span><span class="dt">value</span><span class="op">:</span> _amount<span class="op">}</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-106" title="106">                <span class="cf">if</span> (<span class="op">!</span>success) <span class="op">{</span></a>
<a class="sourceLine" id="cb29-107" title="107">                    revert <span class="at">TransferError</span>(campaignId<span class="op">,</span> _amount<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-108" title="108">                 <span class="op">}</span></a>
<a class="sourceLine" id="cb29-109" title="109">                emit <span class="at">BackerRefundWithdrawn</span>(campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> _amount<span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb29-110" title="110">                <span class="kw">delete</span> partialRefundWaiting[campaignId][<span class="va">msg</span>.<span class="at">sender</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb29-111" title="111">            <span class="op">}</span></a>
<a class="sourceLine" id="cb29-112" title="112"></a>
<a class="sourceLine" id="cb29-113" title="113">        <span class="op">}</span></a>
<a class="sourceLine" id="cb29-114" title="114"></a></code></pre></div>
<h3 id="the-full-contract">The full contract</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1"><span class="co">// SPDX-License-Identifier: GPL-3.0</span></a>
<a class="sourceLine" id="cb30-2" title="2">pragma solidity <span class="op">^</span><span class="dv">0</span>.<span class="fl">8.17</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-3" title="3"></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="co">/**</span></a>
<a class="sourceLine" id="cb30-5" title="5"><span class="co"> * </span><span class="an">@title</span><span class="co"> MyCrowdfunding</span></a>
<a class="sourceLine" id="cb30-6" title="6"><span class="co"> * </span><span class="an">@author</span><span class="co"> Timothee de Almeida &lt; [tim</span><span class="an">@1proamonservice.eu]</span><span class="co"> &gt;</span></a>
<a class="sourceLine" id="cb30-7" title="7"><span class="co"> * </span><span class="an">@dev</span><span class="co"> Implements crowdfunding platform</span></a>
<a class="sourceLine" id="cb30-8" title="8"><span class="co"> * </span><span class="an">@dev</span><span class="co"> This contract is a simple crowdfunding platform where users can create campaigns and other users can donate to them.</span></a>
<a class="sourceLine" id="cb30-9" title="9"><span class="co"> * </span></a>
<a class="sourceLine" id="cb30-10" title="10"><span class="co"> */</span></a>
<a class="sourceLine" id="cb30-11" title="11"></a>
<a class="sourceLine" id="cb30-12" title="12">contract MyCrowdfunding <span class="op">{</span></a>
<a class="sourceLine" id="cb30-13" title="13">    <span class="co">// platform owner address admin of the platform</span></a>
<a class="sourceLine" id="cb30-14" title="14">    address <span class="kw">public</span> platformOwner<span class="op">;</span></a>
<a class="sourceLine" id="cb30-15" title="15">    bool <span class="kw">public</span> _emergencyStop<span class="op">;</span></a>
<a class="sourceLine" id="cb30-16" title="16">    uint constant MIN_RESUME_INTERVAL <span class="op">=</span> <span class="dv">5</span> minutes<span class="op">;</span></a>
<a class="sourceLine" id="cb30-17" title="17">    uint constant MIN_CANCEL_INTERVAL <span class="op">=</span> <span class="dv">72</span> hours<span class="op">;</span></a>
<a class="sourceLine" id="cb30-18" title="18">    uint <span class="kw">private</span> lastResumeTimestamp<span class="op">;</span></a>
<a class="sourceLine" id="cb30-19" title="19">    <span class="co">// backer data structure</span></a>
<a class="sourceLine" id="cb30-20" title="20">    struct BackerData <span class="op">{</span></a>
<a class="sourceLine" id="cb30-21" title="21">        address backer<span class="op">;</span></a>
<a class="sourceLine" id="cb30-22" title="22">        uint88 donation<span class="op">;</span></a>
<a class="sourceLine" id="cb30-23" title="23">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-24" title="24">     <span class="co">//in case of refund </span></a>
<a class="sourceLine" id="cb30-25" title="25">    struct BackerRefund<span class="op">{</span></a>
<a class="sourceLine" id="cb30-26" title="26">        bool locked<span class="op">;</span></a>
<a class="sourceLine" id="cb30-27" title="27">        uint128 refundAmount<span class="op">;</span></a>
<a class="sourceLine" id="cb30-28" title="28">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-29" title="29"></a>
<a class="sourceLine" id="cb30-30" title="30">    <span class="co">// campaign structure which holds the campaign data</span></a>
<a class="sourceLine" id="cb30-31" title="31">    struct Campaign <span class="op">{</span></a>
<a class="sourceLine" id="cb30-32" title="32">        <span class="co">// campaign owner address (20 bytes of 1 slot of 32 bytes)</span></a>
<a class="sourceLine" id="cb30-33" title="33">        address owner<span class="op">;</span></a>
<a class="sourceLine" id="cb30-34" title="34">        <span class="co">// an uint64 is enough to store a timestamp until the year 584554 so it does take 8 bytes of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb30-35" title="35">        uint64 deadline<span class="op">;</span>  </a>
<a class="sourceLine" id="cb30-36" title="36">        <span class="co">// campaign status</span></a>
<a class="sourceLine" id="cb30-37" title="37">        <span class="co">// 0 - draft</span></a>
<a class="sourceLine" id="cb30-38" title="38">        <span class="co">// 1 - active</span></a>
<a class="sourceLine" id="cb30-39" title="39">        <span class="co">// 2 - completed</span></a>
<a class="sourceLine" id="cb30-40" title="40">        <span class="co">// 3 - cancelled</span></a>
<a class="sourceLine" id="cb30-41" title="41">        <span class="co">// 4 - withdrawn</span></a>
<a class="sourceLine" id="cb30-42" title="42">        <span class="co">// 5 - refunded</span></a>
<a class="sourceLine" id="cb30-43" title="43">        <span class="co">// 6 - expired</span></a>
<a class="sourceLine" id="cb30-44" title="44">        <span class="co">// 7 - partially withdrawn</span></a>
<a class="sourceLine" id="cb30-45" title="45">        <span class="co">// 255 - panic stop mode (only set or unset by platform or secureContact</span></a>
<a class="sourceLine" id="cb30-46" title="46">        <span class="co">//a uint8 is enough to store a status code, it takes 1 byte of 1 slot of 32 bytes</span></a>
<a class="sourceLine" id="cb30-47" title="47">        uint8 status<span class="op">;</span></a>
<a class="sourceLine" id="cb30-48" title="48"></a>
<a class="sourceLine" id="cb30-49" title="49">        <span class="co">// here we have used 1 slot so far and we have 3 byte left in the slot to store another variable.</span></a>
<a class="sourceLine" id="cb30-50" title="50">        <span class="co">// we could use this space to store another variable bool for example(1byte) or uint24(3bytes), etc.  </span></a>
<a class="sourceLine" id="cb30-51" title="51"></a>
<a class="sourceLine" id="cb30-52" title="52">        <span class="co">//that is what we do later in the contract explanation..</span></a>
<a class="sourceLine" id="cb30-53" title="53">        bool mutex<span class="op">;</span></a>
<a class="sourceLine" id="cb30-54" title="54">        uint8 backupStatus<span class="op">;</span> <span class="co">//in  case of emergencystop</span></a>
<a class="sourceLine" id="cb30-55" title="55">        <span class="co">//there is now 1 byte free in this slot</span></a>
<a class="sourceLine" id="cb30-56" title="56"></a>
<a class="sourceLine" id="cb30-57" title="57">        <span class="co">// target and amountCollected are uint128 enough to store a value of 340282366920938463463374607431768211455.</span></a>
<a class="sourceLine" id="cb30-58" title="58">        uint128 target<span class="op">;</span>        </a>
<a class="sourceLine" id="cb30-59" title="59">        uint128 amountCollected<span class="op">;</span></a>
<a class="sourceLine" id="cb30-60" title="60">        uint128 amountWithdrawn<span class="op">;</span></a>
<a class="sourceLine" id="cb30-61" title="61">        <span class="co">// from now we are using 1 slot or more per variable.</span></a>
<a class="sourceLine" id="cb30-62" title="62">        <span class="co">// backers array is a dynamic array of backersData structure    </span></a>
<a class="sourceLine" id="cb30-63" title="63">        BackerData[] backersData<span class="op">;</span></a>
<a class="sourceLine" id="cb30-64" title="64"></a>
<a class="sourceLine" id="cb30-65" title="65">        <span class="co">//these string are dynamic and will take more than 1 slot of 32 bytes each.</span></a>
<a class="sourceLine" id="cb30-66" title="66">        string image<span class="op">;</span></a>
<a class="sourceLine" id="cb30-67" title="67">        string title<span class="op">;</span></a>
<a class="sourceLine" id="cb30-68" title="68">        string description<span class="op">;</span>        </a>
<a class="sourceLine" id="cb30-69" title="69">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-70" title="70">    <span class="co">// mapping of campaign IDs to campaign data</span></a>
<a class="sourceLine" id="cb30-71" title="71">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> Campaign) <span class="kw">public</span> campaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb30-72" title="72">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> address) <span class="kw">public</span> campaignOwner<span class="op">;</span></a>
<a class="sourceLine" id="cb30-73" title="73">    <span class="co">//mapping mergency contact</span></a>
<a class="sourceLine" id="cb30-74" title="74">    <span class="at">mapping</span>(address <span class="kw">=&gt;</span> bool) <span class="kw">public</span> emergencyContacts<span class="op">;</span></a>
<a class="sourceLine" id="cb30-75" title="75">    <span class="co">// number of campaigns</span></a>
<a class="sourceLine" id="cb30-76" title="76">    uint <span class="kw">public</span> numberOfCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb30-77" title="77">    <span class="co">//last withdraw activity campaign &amp; address =&gt; timestamps</span></a>
<a class="sourceLine" id="cb30-78" title="78">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> <span class="at">mapping</span>(address <span class="kw">=&gt;</span> uint)) <span class="kw">public</span> lastWithdrawalTimestamp<span class="op">;</span></a>
<a class="sourceLine" id="cb30-79" title="79">    <span class="co">//mapping for partialrefund mapping (capaignId=&gt;mapping(donatorAddress=&gt;BackerRefund))</span></a>
<a class="sourceLine" id="cb30-80" title="80">    <span class="at">mapping</span>(uint <span class="kw">=&gt;</span> <span class="at">mapping</span> (address<span class="kw">=&gt;</span>BackerRefund)) <span class="kw">public</span> partialRefundWaiting<span class="op">;</span></a>
<a class="sourceLine" id="cb30-81" title="81"></a>
<a class="sourceLine" id="cb30-82" title="82">    <span class="co">// events</span></a>
<a class="sourceLine" id="cb30-83" title="83">    event <span class="at">CampaignCreated</span>(uint indexed _campaignId<span class="op">,</span> address indexed _owner<span class="op">,</span> uint _target<span class="op">,</span> uint _deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-84" title="84">    event <span class="at">CampaignStatusChanged</span>(uint indexed _campaignId<span class="op">,</span> uint _status)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-85" title="85">    event <span class="at">DonationReceived</span>(uint indexed _campaignId<span class="op">,</span> address indexed _backer<span class="op">,</span> uint _amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-86" title="86">    event <span class="at">Withdrawal</span>(uint256 indexed _campaignId<span class="op">,</span> address indexed _owner<span class="op">,</span> uint256 _amount<span class="op">,</span> uint256 _timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-87" title="87">    event <span class="at">EmergencyStopChanged</span>(address indexed admin<span class="op">,</span> bool value<span class="op">,</span> uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-88" title="88">    event <span class="at">CampaignEmergencyStopChanged</span>(uint indexed campaingId<span class="op">,</span> address indexed admin<span class="op">,</span> bool value<span class="op">,</span> uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-89" title="89">    event <span class="at">SpeedCancelAlert</span>(uint indexed campaignId<span class="op">,</span>address indexed campaignOwner<span class="op">,</span>uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-90" title="90">    event <span class="at">CancelPending</span>(uint indexed campaignId<span class="op">,</span>address indexed campaignOwner<span class="op">,</span>uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-91" title="91">    event <span class="at">PartialRefundWaitingNotification</span>(uint indexed campaignId<span class="op">,</span> address indexed backer<span class="op">,</span> uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-92" title="92">    event <span class="at">CampaignPartialRefundInitiated</span>(uint campaignId<span class="op">,</span> uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-93" title="93">    event <span class="at">BackerRefundWithdrawn</span>(uint indexed campaignId<span class="op">,</span>address indexed backer <span class="op">,</span> uint amount<span class="op">,</span> uint timestamp)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-94" title="94">    <span class="co">//Customerrors</span></a>
<a class="sourceLine" id="cb30-95" title="95">    error <span class="at">Unauthorized</span>(address caller)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-96" title="96">    error <span class="at">DeadlineError</span>(uint deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-97" title="97">    error <span class="at">CampaignStatusError</span>(uint status)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-98" title="98">    error <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-99" title="99">    error <span class="at">TransferError</span>(uint campaignId<span class="op">,</span> uint amount<span class="op">,</span> address recipient)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-100" title="100">    error <span class="at">InvalidWithdrawValue</span>(uint _request<span class="op">,</span> uint _available)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-101" title="101">    error <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-102" title="102">    error <span class="at">CampaignEmergencyMode</span>(string message)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-103" title="103"></a>
<a class="sourceLine" id="cb30-104" title="104">    <span class="co">//basic functions</span></a>
<a class="sourceLine" id="cb30-105" title="105">    <span class="at">constructor</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb30-106" title="106">        platformOwner <span class="op">=</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-107" title="107">        </a>
<a class="sourceLine" id="cb30-108" title="108">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-109" title="109"></a>
<a class="sourceLine" id="cb30-110" title="110"></a>
<a class="sourceLine" id="cb30-111" title="111"></a>
<a class="sourceLine" id="cb30-112" title="112">    <span class="co">//@dev create a new campaign, will be called by the campaign owner and will be revisited later</span></a>
<a class="sourceLine" id="cb30-113" title="113">    <span class="kw">function</span> <span class="at">createCampaign</span> (address _owner<span class="op">,</span> string memory _title<span class="op">,</span> string memory _description<span class="op">,</span> uint256 _target<span class="op">,</span> uint256 _deadline<span class="op">,</span> string memory _image)  <span class="kw">public</span> <span class="at">returns</span> (uint256) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-114" title="114">        <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb30-115" title="115">        <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-116" title="116">        <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb30-117" title="117">        <span class="cf">if</span>(_deadline <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(_deadline)<span class="op">;</span>    </a>
<a class="sourceLine" id="cb30-118" title="118">        Campaign storage campaign <span class="op">=</span> campaigns[numberOfCampaigns]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-119" title="119">        <span class="co">// we have to use storage here because we are modifying the campaign data</span></a>
<a class="sourceLine" id="cb30-120" title="120">        <span class="va">campaign</span>.<span class="at">owner</span> <span class="op">=</span> _owner<span class="op">;</span></a>
<a class="sourceLine" id="cb30-121" title="121">        <span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">=</span> <span class="at">uint64</span>(_deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-122" title="122">        <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-123" title="123">        <span class="va">campaign</span>.<span class="at">mutex</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-124" title="124">        <span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">=</span><span class="dv">1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-125" title="125">        <span class="va">campaign</span>.<span class="at">target</span> <span class="op">=</span> <span class="at">uint128</span>(_target)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-126" title="126">        <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-127" title="127">        <span class="va">campaign</span>.<span class="at">amountWithdrawn</span><span class="op">=</span><span class="dv">0</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-128" title="128">        <span class="va">campaign</span>.<span class="at">image</span> <span class="op">=</span> _image<span class="op">;</span></a>
<a class="sourceLine" id="cb30-129" title="129">        <span class="va">campaign</span>.<span class="at">title</span> <span class="op">=</span> _title<span class="op">;</span></a>
<a class="sourceLine" id="cb30-130" title="130">        <span class="va">campaign</span>.<span class="at">description</span> <span class="op">=</span>_description<span class="op">;</span></a>
<a class="sourceLine" id="cb30-131" title="131">        campaignOwner[numberOfCampaigns]<span class="op">=</span>_owner<span class="op">;</span>                               </a>
<a class="sourceLine" id="cb30-132" title="132">        numberOfCampaigns<span class="op">++;</span></a>
<a class="sourceLine" id="cb30-133" title="133">        emit <span class="at">CampaignCreated</span>(numberOfCampaigns<span class="dv">-1</span><span class="op">,</span> _owner<span class="op">,</span> _target<span class="op">,</span> _deadline)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-134" title="134">        <span class="cf">return</span> numberOfCampaigns<span class="dv">-1</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-135" title="135">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-136" title="136">    </a>
<a class="sourceLine" id="cb30-137" title="137">    <span class="kw">function</span> <span class="at">donateToCampaign</span> (uint256 _id) <span class="kw">public</span> payable <span class="op">{</span></a>
<a class="sourceLine" id="cb30-138" title="138">        <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb30-139" title="139">        <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-140" title="140">      uint256 amount<span class="op">=</span> <span class="va">msg</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-141" title="141">      Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-142" title="142">      <span class="co">// we check if deadline is in the future if not we throw an error DeadlineError(uint deadline)</span></a>
<a class="sourceLine" id="cb30-143" title="143">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">deadline</span> <span class="op">&lt;=</span> <span class="va">block</span>.<span class="at">timestamp</span>) revert <span class="at">DeadlineError</span>(<span class="va">campaign</span>.<span class="at">deadline</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-144" title="144">        <span class="co">// we check if the campaign is active if not we throw an error CampaignStatusError(uint status)</span></a>
<a class="sourceLine" id="cb30-145" title="145">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span><span class="dv">7</span>) revert <span class="at">CampaignStatusError</span>(<span class="va">campaign</span>.<span class="at">status</span>)<span class="op">;</span>      </a>
<a class="sourceLine" id="cb30-146" title="146">          BackerData memory backerData <span class="op">=</span> <span class="at">BackerData</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb30-147" title="147">              <span class="dt">backer</span><span class="op">:</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-148" title="148">              <span class="dt">donation</span><span class="op">:</span> <span class="at">uint88</span>(amount)</a>
<a class="sourceLine" id="cb30-149" title="149">          <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-150" title="150">          <span class="va">campaign</span>.<span class="va">backersData</span>.<span class="at">push</span>(backerData)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-151" title="151">          <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">=</span> <span class="at">uint128</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">+</span>amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-152" title="152">          emit <span class="at">DonationReceived</span>(_id<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-153" title="153">          <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&gt;=</span> <span class="va">campaign</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-154" title="154">            <span class="co">// if the campaign has reached the target we change the status to 2</span></a>
<a class="sourceLine" id="cb30-155" title="155">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-156" title="156">            <span class="co">// we emit the CampaignStatusChanged event to notify the blockchain that the campaign status has been changed</span></a>
<a class="sourceLine" id="cb30-157" title="157">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">2</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-158" title="158">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-159" title="159">      </a>
<a class="sourceLine" id="cb30-160" title="160">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-161" title="161"></a>
<a class="sourceLine" id="cb30-162" title="162"></a>
<a class="sourceLine" id="cb30-163" title="163">    <span class="kw">function</span> <span class="at">getDonators</span> (uint256 _id) view <span class="kw">public</span> <span class="at">returns</span> (BackerData[] memory) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-164" title="164">      Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-165" title="165">      <span class="cf">return</span> <span class="va">campaign</span>.<span class="at">backersData</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-166" title="166">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-167" title="167"></a>
<a class="sourceLine" id="cb30-168" title="168">    <span class="kw">function</span> <span class="at">getCampaigns</span> () <span class="kw">public</span> view <span class="at">returns</span> (Campaign[] memory)  <span class="op">{</span></a>
<a class="sourceLine" id="cb30-169" title="169">        uint _numberOfCampaigns <span class="op">=</span> numberOfCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb30-170" title="170">        Campaign[] memory allCampaigns <span class="op">=</span> <span class="kw">new</span> Campaign[](_numberOfCampaigns)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-171" title="171">        <span class="cf">for</span> (uint i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i<span class="op">&lt;</span>_numberOfCampaigns<span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-172" title="172">            Campaign storage item <span class="op">=</span> campaigns[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-173" title="173">            Campaign memory campaign <span class="op">=</span> <span class="at">Campaign</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb30-174" title="174">                <span class="dt">owner</span><span class="op">:</span> <span class="va">item</span>.<span class="at">owner</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-175" title="175">                <span class="dt">deadline</span><span class="op">:</span> <span class="va">item</span>.<span class="at">deadline</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-176" title="176">                <span class="dt">status</span><span class="op">:</span> <span class="va">item</span>.<span class="at">status</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-177" title="177">                <span class="dt">mutex</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-178" title="178">                <span class="dt">backupStatus</span><span class="op">:</span><span class="va">item</span>.<span class="at">backupStatus</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-179" title="179">                <span class="dt">target</span><span class="op">:</span> <span class="va">item</span>.<span class="at">target</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-180" title="180">                <span class="dt">amountCollected</span><span class="op">:</span> <span class="va">item</span>.<span class="at">amountCollected</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-181" title="181">                <span class="dt">amountWithdrawn</span><span class="op">:</span> <span class="va">item</span>.<span class="at">amountWithdrawn</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-182" title="182">                <span class="dt">backersData</span><span class="op">:</span> <span class="va">item</span>.<span class="at">backersData</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-183" title="183">                <span class="dt">image</span><span class="op">:</span> <span class="va">item</span>.<span class="at">image</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-184" title="184">                <span class="dt">title</span><span class="op">:</span> <span class="va">item</span>.<span class="at">title</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-185" title="185">                <span class="dt">description</span><span class="op">:</span> <span class="va">item</span>.<span class="at">description</span></a>
<a class="sourceLine" id="cb30-186" title="186">            <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-187" title="187">            allCampaigns[i] <span class="op">=</span> campaign<span class="op">;</span></a>
<a class="sourceLine" id="cb30-188" title="188">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-189" title="189">        <span class="cf">return</span> allCampaigns<span class="op">;</span></a>
<a class="sourceLine" id="cb30-190" title="190">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-191" title="191"></a>
<a class="sourceLine" id="cb30-192" title="192">    <span class="kw">function</span> <span class="at">getCampaignOwner</span> (uint _campaignId) <span class="kw">public</span> view <span class="at">returns</span> (address) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-193" title="193">        <span class="cf">return</span> campaignOwner[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-194" title="194">    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-195" title="195"></a>
<a class="sourceLine" id="cb30-196" title="196"></a>
<a class="sourceLine" id="cb30-197" title="197">    <span class="kw">function</span> <span class="at">withdraw</span>(uint256 _id<span class="op">,</span> uint256 _amount) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-198" title="198">        <span class="co">//we check if platform emergency mode is on</span></a>
<a class="sourceLine" id="cb30-199" title="199">        <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-200" title="200">        Campaign storage campaign <span class="op">=</span> campaigns[_id]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-201" title="201">        <span class="co">// we check the mutex lock for this campaign and verify if it is on</span></a>
<a class="sourceLine" id="cb30-202" title="202">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">mutex</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-203" title="203">        <span class="co">//we check if campaign emergency mode is on</span></a>
<a class="sourceLine" id="cb30-204" title="204">        <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span><span class="op">==</span><span class="dv">255</span>) revert <span class="at">EmergencyMode</span>()<span class="op">;</span>        </a>
<a class="sourceLine" id="cb30-205" title="205">        <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">owner</span> <span class="op">!=</span> <span class="va">msg</span>.<span class="at">sender</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-206" title="206">        uint _available<span class="op">=</span> <span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">-</span><span class="va">campaign</span>.<span class="at">amountWithdrawn</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-207" title="207">        </a>
<a class="sourceLine" id="cb30-208" title="208">        <span class="co">// Acquire the mutex lock for this campaign</span></a>
<a class="sourceLine" id="cb30-209" title="209">        <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span>       </a>
<a class="sourceLine" id="cb30-210" title="210">        uint status<span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-211" title="211">        <span class="cf">if</span> (status <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">2</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">7</span>) revert <span class="at">CampaignStatusError</span>(status)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-212" title="212">        <span class="cf">if</span> (_amount <span class="op">&gt;</span> _available) revert <span class="at">InvalidWithdrawValue</span>(_amount<span class="op">,</span>_available)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-213" title="213">        <span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">+=</span> <span class="at">uint128</span>(_amount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-214" title="214">        <span class="co">// Transfer the Ether to the campaign owner</span></a>
<a class="sourceLine" id="cb30-215" title="215">        (bool success<span class="op">,</span> ) <span class="op">=</span> (<span class="va">msg</span>.<span class="at">sender</span>).<span class="at">call</span><span class="op">{</span><span class="dt">value</span><span class="op">:</span> _amount<span class="op">}</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-216" title="216">        <span class="cf">if</span> (<span class="op">!</span>success) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-217" title="217">        revert <span class="at">TransferError</span>(_id<span class="op">,</span> _amount<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-218" title="218">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-219" title="219">        emit <span class="at">Withdrawal</span>(_id<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> _amount<span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-220" title="220">        <span class="co">// If the campaign has been fully withdrawn but has not reached its target, set the campaign status to &quot;partially withdrawn 7&quot;</span></a>
<a class="sourceLine" id="cb30-221" title="221">        <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&lt;</span> <span class="va">campaign</span>.<span class="at">target</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-222" title="222">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-223" title="223">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">7</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-224" title="224">        <span class="op">}</span> </a>
<a class="sourceLine" id="cb30-225" title="225">        <span class="co">// If the campaign has reached its target and all funds have been withdrawn, set the campaign status to &quot;withdrawn 4&quot;       </span></a>
<a class="sourceLine" id="cb30-226" title="226">        <span class="cf">else</span> <span class="cf">if</span> ( <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">&gt;=</span> <span class="va">campaign</span>.<span class="at">target</span> <span class="op">&amp;&amp;</span> <span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-227" title="227">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-228" title="228">            emit <span class="at">CampaignStatusChanged</span>(_id<span class="op">,</span> <span class="dv">4</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-229" title="229">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-230" title="230">        <span class="co">// Update the last withdrawal timestamp for this campaign and address</span></a>
<a class="sourceLine" id="cb30-231" title="231">        lastWithdrawalTimestamp[_id][<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">=</span> <span class="va">block</span>.<span class="at">timestamp</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-232" title="232">        <span class="co">// Release the mutex lock for this campaign</span></a>
<a class="sourceLine" id="cb30-233" title="233"></a>
<a class="sourceLine" id="cb30-234" title="234">        <span class="va">campaign</span>.<span class="at">mutex</span> <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-235" title="235"></a>
<a class="sourceLine" id="cb30-236" title="236">        <span class="op">}</span> </a>
<a class="sourceLine" id="cb30-237" title="237"></a>
<a class="sourceLine" id="cb30-238" title="238">        <span class="co">//@dev function to stop all actions on the platform</span></a>
<a class="sourceLine" id="cb30-239" title="239">        <span class="kw">function</span> <span class="at">emergencyStop</span>() <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-240" title="240">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb30-241" title="241">            <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-242" title="242">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner <span class="op">||</span>  emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">==</span> <span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-243" title="243">                _emergencyStop <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-244" title="244">                emit <span class="at">EmergencyStopChanged</span>(<span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-245" title="245">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-246" title="246">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-247" title="247"></a>
<a class="sourceLine" id="cb30-248" title="248">        <span class="co">//@dev function to resume normal operations on the platform</span></a>
<a class="sourceLine" id="cb30-249" title="249">        <span class="kw">function</span> <span class="at">resume</span>() <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-250" title="250">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb30-251" title="251">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner <span class="op">||</span> emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">==</span> <span class="kw">true</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-252" title="252">                <span class="co">// add lock-out period to prevent abusive use</span></a>
<a class="sourceLine" id="cb30-253" title="253">                <span class="cf">if</span> (<span class="va">block</span>.<span class="at">timestamp</span> <span class="op">&gt;</span> lastResumeTimestamp <span class="op">+</span> MIN_RESUME_INTERVAL) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-254" title="254">                    _emergencyStop <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-255" title="255">                    lastResumeTimestamp <span class="op">=</span> <span class="va">block</span>.<span class="at">timestamp</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-256" title="256">                    emit <span class="at">EmergencyStopChanged</span>(<span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-257" title="257">                <span class="op">}</span></a>
<a class="sourceLine" id="cb30-258" title="258">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-259" title="259">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-260" title="260">        <span class="co">//@dev function to add an address to the emergencyContacts mapping</span></a>
<a class="sourceLine" id="cb30-261" title="261">        <span class="kw">function</span> <span class="at">addEmergencyContact</span>(address _contact) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-262" title="262">            <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb30-263" title="263">            <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-264" title="264">            <span class="co">// only platform owner can call this function</span></a>
<a class="sourceLine" id="cb30-265" title="265">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-266" title="266">                emergencyContacts[_contact] <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-267" title="267">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-268" title="268">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-269" title="269">        <span class="co">//@dev function to remove an address to the emergencyContacts mapping</span></a>
<a class="sourceLine" id="cb30-270" title="270">        <span class="kw">function</span> <span class="at">removeEmergencyContact</span>(address _contact) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-271" title="271">            <span class="co">//we don&#39;t check if emergency mode is on in this case it could be better to let the owner remove an emergency contact even if the platform is in emergency mode, maybe this emergency contact is not available anymore or responsible of the emergency..         </span></a>
<a class="sourceLine" id="cb30-272" title="272">            <span class="co">// only platform owner can call this function</span></a>
<a class="sourceLine" id="cb30-273" title="273">            <span class="cf">if</span> (<span class="va">msg</span>.<span class="at">sender</span> <span class="op">==</span> platformOwner) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-274" title="274">                emergencyContacts[_contact] <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-275" title="275">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-276" title="276">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-277" title="277">         <span class="co">//@dev function to stop normal operations on the campaign</span></a>
<a class="sourceLine" id="cb30-278" title="278">        <span class="kw">function</span> <span class="at">setCampaignEmergencyStop</span> (uint _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-279" title="279">            <span class="co">//we didn&#39;t check if platform emergency mode is on because admin may have to set emergency stop on campaign to resume normal platform operation</span></a>
<a class="sourceLine" id="cb30-280" title="280">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-281" title="281">            <span class="co">//we check if msg.sender is platformOwner or emergencyContacts</span></a>
<a class="sourceLine" id="cb30-282" title="282">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&amp;&amp;</span> <span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> <span class="va">campaign</span>.<span class="at">owner</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-283" title="283">           </a>
<a class="sourceLine" id="cb30-284" title="284">            </a>
<a class="sourceLine" id="cb30-285" title="285">            <span class="co">//we set the campaign status to 255 it is the panic mode emergency stop value of status if yes we revert no need to set already set</span></a>
<a class="sourceLine" id="cb30-286" title="286">            <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">==</span> <span class="dv">255</span>) revert <span class="at">CampaignEmergencyMode</span>(<span class="st">&quot;campaign already in emergency mode&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-287" title="287">            <span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-288" title="288">            <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="dv">255</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-289" title="289">            emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-290" title="290">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-291" title="291">         <span class="co">//@dev function to resume normal operations on the campaign</span></a>
<a class="sourceLine" id="cb30-292" title="292">        <span class="kw">function</span> <span class="at">campaignResume</span>(uint _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-293" title="293">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb30-294" title="294">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>]) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-295" title="295">            <span class="co">//we set the campaign back to backupstate it is the panic mode emergency OFF  status</span></a>
<a class="sourceLine" id="cb30-296" title="296">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-297" title="297">             <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">status</span> <span class="op">!=</span> <span class="dv">255</span>) revert <span class="at">CampaignEmergencyMode</span>(<span class="st">&quot;campaign not in emergency mode&quot;</span>)<span class="op">;</span>            </a>
<a class="sourceLine" id="cb30-298" title="298">            <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">;</span>   </a>
<a class="sourceLine" id="cb30-299" title="299">            emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">false</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span>         </a>
<a class="sourceLine" id="cb30-300" title="300">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-301" title="301"></a>
<a class="sourceLine" id="cb30-302" title="302"></a>
<a class="sourceLine" id="cb30-303" title="303">        <span class="kw">function</span> <span class="at">cancelCampaign</span>(uint256 _campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-304" title="304">            <span class="co">// Get the campaign data</span></a>
<a class="sourceLine" id="cb30-305" title="305">            Campaign storage campaign <span class="op">=</span> campaigns[_campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-306" title="306">            <span class="co">// Check that the caller is a platform admin or the campaign owner</span></a>
<a class="sourceLine" id="cb30-307" title="307">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&amp;&amp;</span>  <span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> <span class="va">campaign</span>.<span class="at">owner</span>) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-308" title="308">            </a>
<a class="sourceLine" id="cb30-309" title="309">            <span class="co">// Check that the campaign is still active or partial withdrawn or emergency stop mode</span></a>
<a class="sourceLine" id="cb30-310" title="310">            uint status<span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-311" title="311">            <span class="cf">if</span> (status <span class="op">!=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">7</span> <span class="op">&amp;&amp;</span> status <span class="op">!=</span> <span class="dv">255</span>) revert <span class="at">CampaignStatusError</span>(status)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-312" title="312">            <span class="co">//we restrict if campaign.owner == msg.sender</span></a>
<a class="sourceLine" id="cb30-313" title="313">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span><span class="op">==</span><span class="va">campaign</span>.<span class="at">owner</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-314" title="314">                <span class="cf">if</span> (status<span class="op">==</span><span class="dv">255</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-315" title="315">                    emit <span class="at">CancelPending</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-316" title="316">                   <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb30-317" title="317">                <span class="op">}</span></a>
<a class="sourceLine" id="cb30-318" title="318">                <span class="cf">if</span>(status<span class="op">==</span><span class="dv">7</span>)<span class="op">{</span></a>
<a class="sourceLine" id="cb30-319" title="319">                    <span class="cf">if</span>(lastWithdrawalTimestamp[_campaignId][<span class="va">msg</span>.<span class="at">sender</span>] <span class="op">&gt;</span> <span class="va">block</span>.<span class="at">timestamp</span> <span class="op">-</span> MIN_CANCEL_INTERVAL)<span class="op">{</span></a>
<a class="sourceLine" id="cb30-320" title="320">                        emit <span class="at">SpeedCancelAlert</span>(_campaignId<span class="op">,</span><span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span><span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-321" title="321">                    <span class="op">}</span></a>
<a class="sourceLine" id="cb30-322" title="322">                    <span class="va">campaign</span>.<span class="at">backupStatus</span><span class="op">=</span><span class="va">campaign</span>.<span class="at">status</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-323" title="323">                    <span class="va">campaign</span>.<span class="at">status</span><span class="op">=</span><span class="dv">255</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-324" title="324">                    emit <span class="at">CampaignEmergencyStopChanged</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="kw">true</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-325" title="325">                    emit <span class="at">CancelPending</span>(_campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-326" title="326">                    <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb30-327" title="327">                <span class="op">}</span></a>
<a class="sourceLine" id="cb30-328" title="328">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-329" title="329">            </a>
<a class="sourceLine" id="cb30-330" title="330">            <span class="co">// Set the campaign status to &quot;cancelled&quot;</span></a>
<a class="sourceLine" id="cb30-331" title="331">            <span class="va">campaign</span>.<span class="at">status</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-332" title="332">            <span class="co">// Emit an event to record the change in status</span></a>
<a class="sourceLine" id="cb30-333" title="333">            emit <span class="at">CampaignStatusChanged</span>(_campaignId<span class="op">,</span> <span class="dv">3</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-334" title="334">            <span class="cf">return</span> <span class="op">;</span></a>
<a class="sourceLine" id="cb30-335" title="335">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-336" title="336"></a>
<a class="sourceLine" id="cb30-337" title="337">        <span class="kw">function</span> <span class="at">partialRefund</span>(uint campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-338" title="338"></a>
<a class="sourceLine" id="cb30-339" title="339">            <span class="co">// only platform owner or emergency contact can call this function</span></a>
<a class="sourceLine" id="cb30-340" title="340">            <span class="cf">if</span>(<span class="va">msg</span>.<span class="at">sender</span> <span class="op">!=</span> platformOwner <span class="op">&amp;&amp;</span> <span class="op">!</span>emergencyContacts[<span class="va">msg</span>.<span class="at">sender</span>]) revert <span class="at">Unauthorized</span>(<span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-341" title="341">            Campaign storage campaign <span class="op">=</span> campaigns[campaignId]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-342" title="342">            <span class="cf">if</span> (<span class="va">campaign</span>.<span class="at">amountWithdrawn</span> <span class="op">==</span> <span class="va">campaign</span>.<span class="at">amountCollected</span>) <span class="op">{</span>               </a>
<a class="sourceLine" id="cb30-343" title="343">                <span class="cf">return</span><span class="op">;</span> <span class="co">// nothing to do</span></a>
<a class="sourceLine" id="cb30-344" title="344">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-345" title="345"></a>
<a class="sourceLine" id="cb30-346" title="346">            uint refundAmount <span class="op">=</span> <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">-</span> <span class="va">campaign</span>.<span class="at">amountWithdrawn</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-347" title="347">            uint percentage <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> refundAmount / <span class="va">campaign</span>.<span class="at">amountCollected</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-348" title="348">            uint tmp<span class="op">=</span><span class="va">campaign</span>.<span class="va">backersData</span>.<span class="at">length</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-349" title="349">            <span class="co">// we check the mutex lock for this campaign and verify if it is on</span></a>
<a class="sourceLine" id="cb30-350" title="350">            <span class="cf">if</span>(<span class="va">campaign</span>.<span class="at">mutex</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-351" title="351">            <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-352" title="352">            <span class="co">//we give property of the refundamount to backers through this mapping </span></a>
<a class="sourceLine" id="cb30-353" title="353">            <span class="cf">for</span> (uint i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> tmp<span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-354" title="354">                BackerData storage backer <span class="op">=</span> <span class="va">campaign</span>.<span class="at">backersData</span>[i]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-355" title="355">                uint backerRefundAmount <span class="op">=</span> <span class="va">backer</span>.<span class="at">donation</span> <span class="op">*</span> percentage / <span class="dv">100</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-356" title="356">                BackerRefund memory refundprocess <span class="op">=</span> <span class="at">BackerRefund</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb30-357" title="357">              <span class="dt">locked</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-358" title="358">              <span class="dt">refundAmount</span><span class="op">:</span> <span class="at">uint128</span>(backerRefundAmount)</a>
<a class="sourceLine" id="cb30-359" title="359">          <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-360" title="360">                partialRefundWaiting[campaignId][<span class="va">backer</span>.<span class="at">backer</span>]<span class="op">=</span>refundprocess<span class="op">;</span></a>
<a class="sourceLine" id="cb30-361" title="361">                <span class="va">backer</span>.<span class="at">donation</span> <span class="op">-=</span> <span class="at">uint88</span>(backerRefundAmount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-362" title="362">                emit <span class="at">PartialRefundWaitingNotification</span>(campaignId<span class="op">,</span> <span class="va">backer</span>.<span class="at">backer</span><span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span>                </a>
<a class="sourceLine" id="cb30-363" title="363">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-364" title="364">            <span class="co">// we substract the refundAmount from the collectedAmount</span></a>
<a class="sourceLine" id="cb30-365" title="365">            <span class="va">campaign</span>.<span class="at">amountCollected</span> <span class="op">-=</span> <span class="at">uint128</span>(refundAmount)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-366" title="366">            emit <span class="at">CampaignPartialRefundInitiated</span>(campaignId<span class="op">,</span><span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-367" title="367">            <span class="co">// we free the mutex</span></a>
<a class="sourceLine" id="cb30-368" title="368">            <span class="va">campaign</span>.<span class="at">mutex</span><span class="op">=</span><span class="kw">false</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-369" title="369"></a>
<a class="sourceLine" id="cb30-370" title="370">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-371" title="371"></a>
<a class="sourceLine" id="cb30-372" title="372">        <span class="kw">function</span> <span class="at">backerRefundWithdraw</span>(uint campaignId) <span class="kw">public</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-373" title="373">            <span class="co">//we check if emergency mode is on</span></a>
<a class="sourceLine" id="cb30-374" title="374">            <span class="cf">if</span>(_emergencyStop) revert <span class="at">EmergencyMode</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-375" title="375">            BackerRefund storage refundprocess <span class="op">=</span> partialRefundWaiting[campaignId][<span class="va">msg</span>.<span class="at">sender</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-376" title="376">            <span class="cf">if</span>(<span class="va">refundprocess</span>.<span class="at">locked</span>) revert <span class="at">LockError</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb30-377" title="377">            <span class="va">refundprocess</span>.<span class="at">locked</span><span class="op">=</span><span class="kw">true</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-378" title="378">            <span class="cf">if</span> ( <span class="va">refundprocess</span>.<span class="at">refundAmount</span> <span class="op">&gt;</span> <span class="dv">0</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-379" title="379">                uint _amount<span class="op">=</span><span class="va">refundprocess</span>.<span class="at">refundAmount</span><span class="op">;</span></a>
<a class="sourceLine" id="cb30-380" title="380">                <span class="co">// Transfer the Ether to the campaign owner</span></a>
<a class="sourceLine" id="cb30-381" title="381">                (bool success<span class="op">,</span> ) <span class="op">=</span> (<span class="va">msg</span>.<span class="at">sender</span>).<span class="at">call</span><span class="op">{</span><span class="dt">value</span><span class="op">:</span> _amount<span class="op">}</span>(<span class="st">&quot;&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-382" title="382">                <span class="cf">if</span> (<span class="op">!</span>success) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-383" title="383">                    revert <span class="at">TransferError</span>(campaignId<span class="op">,</span> _amount<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-384" title="384">                 <span class="op">}</span></a>
<a class="sourceLine" id="cb30-385" title="385">                emit <span class="at">BackerRefundWithdrawn</span>(campaignId<span class="op">,</span> <span class="va">msg</span>.<span class="at">sender</span><span class="op">,</span> _amount<span class="op">,</span> <span class="va">block</span>.<span class="at">timestamp</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-386" title="386">                <span class="kw">delete</span> partialRefundWaiting[campaignId][<span class="va">msg</span>.<span class="at">sender</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb30-387" title="387">            <span class="op">}</span></a>
<a class="sourceLine" id="cb30-388" title="388"></a>
<a class="sourceLine" id="cb30-389" title="389">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-390" title="390"></a>
<a class="sourceLine" id="cb30-391" title="391"><span class="op">}</span> <span class="co">//end of contract</span></a></code></pre></div>
<p>The contract is now ready to be deployed to the testnet.</p>
<p>So far we have created a smart contract who can manage a crowdfunding platform with multiple campaigns. we can do the following actions:</p>
<ul>
<li>create a campaign</li>
<li>contribute to a campaign</li>
<li>withdraw funds from a campaign</li>
<li>cancel a campaign</li>
<li>set emergency stop on the platform</li>
<li>set emergency stop on a campaign</li>
<li>resume normal operations on the platform</li>
<li>resume normal operations on a campaign</li>
<li>add an emergency contact</li>
<li>remove an emergency contact</li>
<li>partial refund of a campaign</li>
<li>withdraw partial refund by backers</li>
</ul>
<p>To do this we have discovered the following solidity features:</p>
<ul>
<li>structs</li>
<li>mappings</li>
<li>arrays</li>
<li>tight packing of variables in storage</li>
<li>using custom errors to revert transactions</li>
<li>using events to log data</li>
<li>using mapping as key to another mapping</li>
<li>using tests to restrict access to functions</li>
<li>using locks to prevent reentrancy attacks</li>
<li>using the call function to send ether to another address</li>
</ul>
<p>There is room for optimization and improvement but this is a good start.</p>
<p>We will add more to it later during the tutorial.</p>
<p>for now we will experiment the power of thirdweb and deploy easily our contract to the testnet.</p>
<h2 id="deploying-the-contract-to-the-testnet">Deploying the contract to the testnet</h2>
<ol type="1">
<li>in the web3 folder create a new file called .env and add the following code:</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1">PRIVATE_KEY<span class="op">=</span>your <span class="kw">private</span> key</a></code></pre></div>
<p>To obtain this private key open metamask and click on the account details icon and then click on the export private key button.</p>
<ol start="2" type="1">
<li>add to this file the quicknode url from your dashboard</li>
</ol>
<p>create a ethereum goerli testnet endpoint and copy the url.</p>
<p>copy it into the .env file and add it to the end of the url like this:</p>
<pre><code>PRIVATE_KEY=your private key
QUICKNODE_URL=your quicknode url</code></pre>
<p>and go to the file hardhat.config.js and add the url to the networks section that we will create.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1">defaultNetwork<span class="op">=</span><span class="st">&#39;goerli&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-2" title="2">networks<span class="op">:{</span></a>
<a class="sourceLine" id="cb33-3" title="3">    <span class="dt">hardhat</span><span class="op">:{},</span></a>
<a class="sourceLine" id="cb33-4" title="4">    <span class="dt">goerli</span><span class="op">:{</span></a>
<a class="sourceLine" id="cb33-5" title="5">        <span class="dt">url</span><span class="op">:</span><span class="va">process</span>.<span class="va">env</span>.<span class="at">QUICKNODE_URL</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-6" title="6">        <span class="dt">accounts</span><span class="op">:</span>[<span class="va">process</span>.<span class="va">env</span>.<span class="at">PRIVATE_KEY</span>]</a>
<a class="sourceLine" id="cb33-7" title="7">    <span class="op">}</span></a>
<a class="sourceLine" id="cb33-8" title="8"><span class="op">},</span></a></code></pre></div>
<p>And there we are we have our contract ready to be deployed to the testnet. so let’s do it. in the terminal go to the web3 folder and run the following command:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb34-1" title="1"><span class="ex">npm</span> run deploy</a></code></pre></div>
<figure>
<img src="./images/npmrundeploy1.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>After that just click on the link to see confirm the transaction in metamask. it will pop up two times, click accept on both of them.</p>
<p>A short while later you will see the contract address and a dashboard with the contract details.</p>
<p>We will take the time to explore a little bit what thirdweb has to offer.</p>
<p>First of all, we can see the contract address and the transaction hash, and we can see the contract details.</p>
<p>Read and write functions are displayed in the dashboard, in an easy to use interface as we can see in these two screenshots.</p>
<figure>
<img src="./images/thirdwebdashboard.png" alt="image" /><figcaption>image</figcaption>
</figure>
<figure>
<img src="./images/thirdwebdashboard2.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>the events are displayed in the events section, but for now nothing to show there.</p>
<p>the code section, is how to use the contract in:</p>
<ul>
<li>a react app</li>
<li>a javascript app</li>
<li>a python app</li>
<li>a Go app</li>
</ul>
<figure>
<img src="./images/thirdwebdashboardcode.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>then the source code of the contract and the ABI is displayed in the source code section. there you have a button to verify the code immediatly on etherscan in this case</p>
<figure>
<img src="./images/thirdwebdashboardsources.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>And you can also explore the link on the navbar there is a ton of information there too long to cover in this tutorial. <img src="./images/thirdwebdashboardnavbar.png" alt="image" /></p>
<p>As an example let’s explore the link explore</p>
<figure>
<img src="./images/thirdwebexplore.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p><strong>Or the doc portal</strong> <a href="https://doc.thirdweb.io/">https://doc.thirdweb.io/</a></p>
<figure>
<img src="./images/thirdwebdocportal.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>we will come back later to the smart contract and add more functions to it.</p>
<p>We are at the end of the first part of this tutorial.</p>
<p><strong>This is a great time to take a break and drink a cup of coffee or some water even best. go for a ride and come back to it later.</strong></p>
<p>For now let’s create a react app to interact with the contract.</p>
<h2 id="creating-the-app">Creating the app</h2>
<p>In the terminal got to the client folder.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb35-1" title="1">$ <span class="bu">cd</span> ../client</a></code></pre></div>
<figure>
<img src="./images/cdClient.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>In the terminal, run the following command to create a new Vite app in the client folder:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb36-1" title="1">$ <span class="ex">npx</span> thirdweb create --app</a></code></pre></div>
<figure>
<img src="./images/npxthirdwebcreateapp.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>One last element to add is the react-router-dom package. This package will allow us to navigate between pages in our application. To add this package, run the following command in the terminal:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb37-1" title="1">$ <span class="ex">npm</span> install react-router-dom</a></code></pre></div>
<p>Now execute the following command to start the development server:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb38-1" title="1">$ <span class="ex">yarn</span> dev</a>
<a class="sourceLine" id="cb38-2" title="2"><span class="kw">then</span> <span class="ex">click</span> on the link that appears in the terminal to open the application in your browser.</a>
<a class="sourceLine" id="cb38-3" title="3">  <span class="ex">http</span>://localhost:5173/</a></code></pre></div>
<figure>
<img src="./images/npmrundev.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>make ctrl+c in the terminal to stop the server.</p>
<p>Great news, we have our react app ready to be styled and interact with the smart contract, but as we made it from scratch, in the terminal we will run the following command to delete all files there:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb39-1" title="1">$ <span class="fu">rm</span> -rf * <span class="kw">&amp;&amp;</span> <span class="fu">rm</span> -rf .*</a></code></pre></div>
<p>then we will create our first file in the src folder called main.jsx, this is the main file of our react app, in the terminal type.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb40-1" title="1">$ <span class="fu">touch</span> main.jsx</a></code></pre></div>
<figure>
<img src="./images/touchmainjsx.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>so let’s add some code to it.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb41-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb41-2" title="2"><span class="im">import</span> ReactDOM <span class="im">from</span> <span class="st">&#39;react-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="im">import</span> <span class="op">{</span> BrowserRouter <span class="im">as</span> Router<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb41-4" title="4"><span class="im">import</span> <span class="op">{</span> ChainId<span class="op">,</span> DAppProvider <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;@thirdweb-dev/react&#39;</span><span class="op">;</span></a></code></pre></div>
<h3 id="adding-tailwind-css">Adding Tailwind CSS</h3>
<p>We will be using Tailwind CSS to style our application. Tailwind CSS is a utility-first CSS framework that allows you to quickly build custom designs without having to write any CSS. It is a great tool for building web applications because it is lightweight, easy to use, and has a lot of useful features. you can find more about tailwind css <a href="https://tailwindcss.com/docs/guides/create-react-app" title="tailwindcss">here</a></p>
<p>To add Tailwind CSS to our project, we will run the following command in the terminal:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb42-1" title="1">$ <span class="ex">npm</span> install -D tailwindcss postcss autoprefixer</a>
<a class="sourceLine" id="cb42-2" title="2">$ <span class="ex">npx</span> tailwindcss init -p</a></code></pre></div>
<figure>
<img src="./images/npmtailwindcss.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>This will create a tailwind.config.cjs file in the root directory of our project. This file contains the configuration for Tailwind CSS. We will need to add the following line to the file:</p>
<pre><code>module.exports = {

  content: [
 
    &quot;./src/**/*.{js,jsx,ts,tsx}&quot;,
 
  ],
 
  theme: {
 
    extend: {},
 
  },
 
  plugins: [],
 
 }</code></pre>
<p>now in the src folder into your index.css file replace the content by the following line as stated in the documentation of tailwindcss:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb44-1" title="1"><span class="im">@tailwind</span> base<span class="op">;</span></a>
<a class="sourceLine" id="cb44-2" title="2"><span class="im">@tailwind</span> components<span class="op">;</span></a>
<a class="sourceLine" id="cb44-3" title="3"><span class="im">@tailwind</span> utilities<span class="op">;</span></a></code></pre></div>
<p>And finally we need to import this file in the main.jsx file, so in the main.jsx file add the following line:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb45-1" title="1"><span class="im">import</span> <span class="st">&#39;./index.css&#39;</span><span class="op">;</span></a></code></pre></div>
<p>you can go now to the src folder and open the App.js file and replace the content by the following code:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb46-1" title="1"><span class="im">import</span> <span class="op">{</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span></a>
<a class="sourceLine" id="cb46-2" title="2"></a>
<a class="sourceLine" id="cb46-3" title="3"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span><span class="op">{</span></a>
<a class="sourceLine" id="cb46-4" title="4">  <span class="kw">const</span> [count<span class="op">,</span> setCount] <span class="op">=</span> <span class="at">useState</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb46-5" title="5"></a>
<a class="sourceLine" id="cb46-6" title="6">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb46-7" title="7">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;App&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-8" title="8">     <span class="op">&lt;</span>h1 className<span class="op">=</span><span class="st">&quot;text-xl font-bold underline&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-9" title="9">      Hello world<span class="op">!</span></a>
<a class="sourceLine" id="cb46-10" title="10">    &lt;/h1<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-11" title="11">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb46-12" title="12">  )</a>
<a class="sourceLine" id="cb46-13" title="13"><span class="op">}</span></a>
<a class="sourceLine" id="cb46-14" title="14"></a>
<a class="sourceLine" id="cb46-15" title="15"><span class="im">export</span> <span class="im">default</span> App</a>
<a class="sourceLine" id="cb46-16" title="16"></a></code></pre></div>
<p>save the file and go back to the terminal and run the following command to start the development server:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1">$ <span class="ex">npm</span> run dev</a></code></pre></div>
<p>open the link in the browser and you will see the following result:</p>
<figure>
<img src="./images/firstrun.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>As we see the bold and underline text is the one we added in the App.js file. and if we view the bold and underline effect it means that tailwindcss is working.</p>
<p>Now we can add the assets folder in the src folder and add the downloaded files from this <a href="./files/assets.zip" title="assets">link here</a></p>
<p>These are sample images and icons that we will use in our app, you can add your own.</p>
<p>Now in the terminal in the src folder we add another folder named constants and in it we add a file called index.js and we add the following code:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb48-1" title="1"></a>
<a class="sourceLine" id="cb48-2" title="2"><span class="im">import</span> <span class="op">{</span> createCampaign<span class="op">,</span> dashboard<span class="op">,</span> logout<span class="op">,</span> payment<span class="op">,</span> profile<span class="op">,</span> withdraw <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../assets&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb48-3" title="3"></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="im">export</span> <span class="kw">const</span> navlinks <span class="op">=</span> [</a>
<a class="sourceLine" id="cb48-5" title="5">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-6" title="6">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-7" title="7">    <span class="dt">imgUrl</span><span class="op">:</span> dashboard<span class="op">,</span></a>
<a class="sourceLine" id="cb48-8" title="8">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-9" title="9">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-10" title="10">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-11" title="11">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;campaign&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-12" title="12">    <span class="dt">imgUrl</span><span class="op">:</span> createCampaign<span class="op">,</span></a>
<a class="sourceLine" id="cb48-13" title="13">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/create-campaign&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-14" title="14">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-15" title="15">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-16" title="16">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;payment&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-17" title="17">    <span class="dt">imgUrl</span><span class="op">:</span> payment<span class="op">,</span></a>
<a class="sourceLine" id="cb48-18" title="18">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-19" title="19">    <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-20" title="20">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-21" title="21">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-22" title="22">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;withdraw&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-23" title="23">    <span class="dt">imgUrl</span><span class="op">:</span> withdraw<span class="op">,</span></a>
<a class="sourceLine" id="cb48-24" title="24">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-25" title="25">    <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-26" title="26">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-27" title="27">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-28" title="28">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;profile&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-29" title="29">    <span class="dt">imgUrl</span><span class="op">:</span> profile<span class="op">,</span></a>
<a class="sourceLine" id="cb48-30" title="30">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/profile&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-31" title="31">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-32" title="32">  <span class="op">{</span></a>
<a class="sourceLine" id="cb48-33" title="33">    <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;logout&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-34" title="34">    <span class="dt">imgUrl</span><span class="op">:</span> logout<span class="op">,</span></a>
<a class="sourceLine" id="cb48-35" title="35">    <span class="dt">link</span><span class="op">:</span> <span class="st">&#39;/&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-36" title="36">    <span class="dt">disabled</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb48-37" title="37">  <span class="op">},</span></a>
<a class="sourceLine" id="cb48-38" title="38">]<span class="op">;</span></a></code></pre></div>
<p>This is mainly the navigation bar of our app, we will add the navigation bar in a next step. we now add somes more folders that we will need in the src folder, create the context, components, pages, and utils folders. For now we will add context to our app this allow us to share data between components without having to pass props down manually at every level, and this let us use the thirdweb sdk accross all parts of our app. to create these folders in the src folder in the terminal type:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb49-1" title="1"><span class="fu">mkdir</span> context components pages utils</a></code></pre></div>
<p>Inside the utils folder we add a file called index.js and we add the following code:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb50-1" title="1"></a>
<a class="sourceLine" id="cb50-2" title="2"><span class="im">export</span> <span class="kw">const</span> daysLeft <span class="op">=</span> (deadline) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb50-3" title="3">  </a>
<a class="sourceLine" id="cb50-4" title="4">  <span class="kw">const</span> difference <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>(deadline).<span class="at">getTime</span>()<span class="op">-</span> (<span class="va">Math</span>.<span class="at">floor</span>(<span class="va">Date</span>.<span class="at">now</span>() / <span class="dv">1000</span>))<span class="op">;</span>  <span class="co">//</span></a>
<a class="sourceLine" id="cb50-5" title="5">  </a>
<a class="sourceLine" id="cb50-6" title="6">  <span class="kw">const</span> remainingDays <span class="op">=</span> difference / (<span class="dv">3600</span> <span class="op">*</span> <span class="dv">24</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-7" title="7"></a>
<a class="sourceLine" id="cb50-8" title="8">  <span class="cf">return</span> <span class="va">remainingDays</span>.<span class="at">toFixed</span>(<span class="dv">0</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-9" title="9"><span class="op">};</span></a>
<a class="sourceLine" id="cb50-10" title="10"></a>
<a class="sourceLine" id="cb50-11" title="11">  </a>
<a class="sourceLine" id="cb50-12" title="12">  <span class="im">export</span> <span class="kw">const</span> calculateBarPercentage <span class="op">=</span> (goal<span class="op">,</span> raisedAmount) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb50-13" title="13">    <span class="kw">const</span> percentage <span class="op">=</span> <span class="va">Math</span>.<span class="at">round</span>((raisedAmount <span class="op">*</span> <span class="dv">100</span>) / goal)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-14" title="14">  </a>
<a class="sourceLine" id="cb50-15" title="15">    <span class="cf">return</span> percentage<span class="op">;</span></a>
<a class="sourceLine" id="cb50-16" title="16">  <span class="op">};</span></a>
<a class="sourceLine" id="cb50-17" title="17">  </a>
<a class="sourceLine" id="cb50-18" title="18">  <span class="im">export</span> <span class="kw">const</span> checkIfImage <span class="op">=</span> (url<span class="op">,</span> callback) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb50-19" title="19">    <span class="kw">const</span> img <span class="op">=</span> <span class="kw">new</span> <span class="at">Image</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb50-20" title="20">    <span class="va">img</span>.<span class="at">src</span> <span class="op">=</span> url<span class="op">;</span></a>
<a class="sourceLine" id="cb50-21" title="21">  </a>
<a class="sourceLine" id="cb50-22" title="22">    <span class="cf">if</span> (<span class="va">img</span>.<span class="at">complete</span>) <span class="at">callback</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-23" title="23">  </a>
<a class="sourceLine" id="cb50-24" title="24">    <span class="va">img</span>.<span class="at">onload</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">callback</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-25" title="25">    <span class="va">img</span>.<span class="at">onerror</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">callback</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb50-26" title="26">  <span class="op">};</span></a>
<a class="sourceLine" id="cb50-27" title="27">  </a></code></pre></div>
<p>These are some functions that we will use in our app, nothing special here. we now move to our app.jsx file in the src folder and we add the following code:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb51-1" title="1"><span class="im">import</span> <span class="op">{</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb51-2" title="2"><span class="im">import</span> <span class="op">{</span>Route<span class="op">,</span>Routes<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="im">import</span> <span class="op">{</span> BrowserRouter <span class="im">as</span> Router<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a></code></pre></div>
<p>then we can create our wrapper div which we will style using Tailwind CSS. Tailwind CSS is a super helpful tool for quickly styling your websites and apps. It gives you a bunch of low-level utility classes that you can mix and match to create the look and feel you want. Plus, it’s really easy to customize and make your own!</p>
<p>It’s a game-changer for streamlining your styling process and making your projects look awesome. at anytime you can refer to the documentation of tailwindcss <a href="https://tailwindcss.com/docs" title="tailwindcss documentation">here</a> and search (ctrl+k open the search or the search box ) for the class we use in the code below. <img src="./images/tailwindcssdoc.png" alt="image" /></p>
<p>so add this after the import statements into the const App = () =&gt;{} function:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb52-1" title="1"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span><span class="op">{</span></a>
<a class="sourceLine" id="cb52-2" title="2"> </a>
<a class="sourceLine" id="cb52-3" title="3">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb52-4" title="4">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;relative sm:-8 p-4 bg-primary min-h-screen flex flex-row&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-5" title="5">     <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;sm:flex hidden mr-10 relative&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-6" title="6">      Sidebar</a>
<a class="sourceLine" id="cb52-7" title="7">     &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-8" title="8">     <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex-1 max-sm:w-full max-w-[1280px] mx-auto sm:pr-5 &quot;</span> <span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-9" title="9">        Navbar</a>
<a class="sourceLine" id="cb52-10" title="10">     &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-11" title="11">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb52-12" title="12">  )</a>
<a class="sourceLine" id="cb52-13" title="13"><span class="op">}</span></a>
<a class="sourceLine" id="cb52-14" title="14"></a>
<a class="sourceLine" id="cb52-15" title="15"><span class="im">export</span> <span class="im">default</span> App</a></code></pre></div>
<p>the code above is the wrapper div of our app, we will add the sidebar and the navbar in the next steps. but we need to add some information to the tailwind.config.js file in the root folder of our project. so open the file and add the colors section to the theme section with the following code:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb53-1" title="1"> theme<span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb53-2" title="2">     <span class="dt">colors</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb53-3" title="3">       <span class="dt">primary</span><span class="op">:</span> <span class="st">&#39;#1f2d93d8&#39;</span> <span class="op">,</span></a>
<a class="sourceLine" id="cb53-4" title="4">      <span class="dt">secondary</span><span class="op">:</span><span class="st">&#39;#1f2d4baa&#39;</span> <span class="op">,</span></a>
<a class="sourceLine" id="cb53-5" title="5">      <span class="dt">third</span><span class="op">:</span> <span class="st">&#39;#ced0d5&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb53-6" title="6">      <span class="dt">fourth</span><span class="op">:</span> <span class="st">&#39;#6c1288a9&#39;</span><span class="op">,</span>      </a>
<a class="sourceLine" id="cb53-7" title="7">      <span class="dt">fifth</span><span class="op">:</span> <span class="st">&#39;#ede8e4&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb53-8" title="8">      <span class="dt">sixth</span><span class="op">:</span><span class="st">&#39;#8a8381&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb53-9" title="9">      <span class="dt">seventh</span><span class="op">:</span><span class="st">&#39;#c8c7c9&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb53-10" title="10">      <span class="dt">height</span><span class="op">:</span> <span class="st">&#39;#c1afa8&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb53-11" title="11">    <span class="op">},</span></a>
<a class="sourceLine" id="cb53-12" title="12">  </a></code></pre></div>
<p>so no we have to add some route to our app so in the app.jsx file in the src folder we add the following code after the Navbar below the word inside the same div we will also modify the code for Navbar and Sidebar look at the code below:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb54-1" title="1"></a>
<a class="sourceLine" id="cb54-2" title="2"><span class="kw">const</span> App <span class="op">=</span> () <span class="kw">=&gt;</span><span class="op">{</span></a>
<a class="sourceLine" id="cb54-3" title="3"> </a>
<a class="sourceLine" id="cb54-4" title="4">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb54-5" title="5">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;relative sm:-8 p-4 bg-primary min-h-screen flex flex-row&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-6" title="6">     <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;sm:flex hidden mr-10 relative&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-7" title="7">      <span class="op">&lt;</span>Sidebar /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-8" title="8">     &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-9" title="9">     <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex-1 max-sm:w-full max-w-[1280px] mx-auto sm:pr-5 &quot;</span> <span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-10" title="10">        <span class="op">&lt;</span>Navbar /<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-11" title="11">      <span class="op">&lt;</span>Routes<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-12" title="12">          <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/&quot;</span> element<span class="op">={&lt;</span>Home /<span class="op">&gt;}</span> /&gt;</a>
<a class="sourceLine" id="cb54-13" title="13">          <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/profile&quot;</span> element<span class="op">={&lt;</span>Profile /<span class="op">&gt;}</span> /&gt;</a>
<a class="sourceLine" id="cb54-14" title="14">          <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/campaign-details/:id&quot;</span> element<span class="op">={&lt;</span>CampaignDetails /<span class="op">&gt;}</span> /&gt;</a>
<a class="sourceLine" id="cb54-15" title="15">          <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/create-campaign&quot;</span> element<span class="op">={&lt;</span>CreateCampaign /<span class="op">&gt;}</span>/&gt;</a>
<a class="sourceLine" id="cb54-16" title="16">          <span class="op">&lt;</span>Route path<span class="op">=</span><span class="st">&quot;/about&quot;</span> element<span class="op">={&lt;</span>About /<span class="op">&gt;}</span> /&gt;</a>
<a class="sourceLine" id="cb54-17" title="17">      &lt;/Routes<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-18" title="18">     &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-19" title="19">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb54-20" title="20">  )</a>
<a class="sourceLine" id="cb54-21" title="21"><span class="op">}</span></a>
<a class="sourceLine" id="cb54-22" title="22"> </a></code></pre></div>
<p>if you take a look at the website for now it would be in error as we have not added the components and the pages yet.</p>
<p>you can create the pages and components files in the pages and components folder respectively. So to the components folder we add a file called Navbar.jsx and Sidebar.jsx and to the pages folder we add these files called Home.jsx, About.jsx, CreateCampaign.jsx, CampaignDetails.jsx, and Profile.jsx</p>
<p>It is a great time to talk about a vscode extension that will help us a lot in our project and other development projects. this extension is es7 React/js snippets. this extension is a collection of React, Redux and Graphql code snippets for ES7 and ES6 syntaxes. to install this extension in vscode we can use the shortcut Launch Quick Open:</p>
<p>Linux: Ctrl+P macOS: ⌘P Windows: Ctrl+P Paste the following command and press Enter:</p>
<pre><code>ext install dsznajder.es7-react-js-snippets</code></pre>
<p>you can find more informations about it here <a href="https://marketplace.visualstudio.com/items?itemName=dsznajder.es7-react-js-snippets" title="es7 React/js snippets">es7 React/js snippets</a></p>
<p>Then in each of these files we use the following snippet from this snippet extension to create the basic structure of the component or page.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb56-1" title="1">rafce</a></code></pre></div>
<p><img src="./images/rafce.png" alt="image" /> select it and it expand immediatly into the following code:</p>
<figure>
<img src="./images/rafceexpand.png" alt="image" /><figcaption>image</figcaption>
</figure>
<p>as we have the basic structure of our app we can now create a last file in these two folders, components and pages so we call this file index.js in the pages folder we add the following code:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb57-1" title="1"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> Home<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./Home&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-2" title="2"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> Profile<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./Profile&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-3" title="3"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> CreateCampaign<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./CreateCampaign&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> CampaignDetails<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./CampaignDetails&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> About<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./About&#39;</span><span class="op">;</span></a></code></pre></div>
<p>and in the components folder we add index.js file with the following code:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb58-1" title="1"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> Sidebar<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./Sidebar&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb58-2" title="2"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> Navbar<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./Navbar&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Now we can import these files in the App.jsx file in the src folder and add to the code we created before the following code in the import section:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb59-1" title="1"><span class="im">import</span> <span class="op">{</span> Sidebar<span class="op">,</span> Navbar  <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./components&#39;</span></a>
<a class="sourceLine" id="cb59-2" title="2"><span class="im">import</span> <span class="op">{</span>Home<span class="op">,</span> About<span class="op">,</span> CreateCampaign<span class="op">,</span> CampaignDetails<span class="op">,</span> Profile<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./pages&#39;</span><span class="op">;</span></a></code></pre></div>
<p>now we can develop the components Sidebar, so open the Sidebar.jsx file in the components folder and add the following code:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb60-1" title="1"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> useState <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb60-2" title="2"><span class="im">import</span> <span class="op">{</span> Link<span class="op">,</span> useNavigate <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb60-3" title="3"></a>
<a class="sourceLine" id="cb60-4" title="4"><span class="im">import</span> <span class="op">{</span>logo<span class="op">,</span> sun<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../assets&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb60-5" title="5"><span class="im">import</span> <span class="op">{</span> navlinks <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../constants&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb60-6" title="6"></a>
<a class="sourceLine" id="cb60-7" title="7"><span class="kw">const</span> Icon <span class="op">=</span> (<span class="op">{</span>styles<span class="op">,</span> name<span class="op">,</span> imgUrl<span class="op">,</span> isActive<span class="op">,</span> disabled<span class="op">,</span> handleClick<span class="op">}</span>) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb60-8" title="8">    <span class="op">&lt;</span>div className<span class="op">={</span><span class="vs">`w-[48px] h-[48px] rounded-[10px] </span><span class="sc">${</span>isActive <span class="op">&amp;&amp;</span> isActive <span class="op">===</span> name <span class="op">&amp;&amp;</span> <span class="st">&#39;bg-fourth&#39;</span><span class="sc">}</span><span class="vs"> flex justify-center items-center </span><span class="sc">${</span><span class="op">!</span>disabled <span class="op">&amp;&amp;</span> <span class="st">&#39;cursor-pointer&#39;</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>styles<span class="sc">}</span><span class="vs"> `</span><span class="op">}</span> onClick<span class="op">={</span>handleClick<span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb60-9" title="9">        <span class="op">{!</span>isActive <span class="op">?</span> (</a>
<a class="sourceLine" id="cb60-10" title="10">            <span class="op">&lt;</span>img src<span class="op">={</span>imgUrl<span class="op">}</span> alt<span class="op">={</span><span class="st">&quot;fund_logo&quot;</span><span class="op">}</span> className<span class="op">=</span><span class="st">&quot;w-1/2 h-1/2&quot;</span> /&gt; </a>
<a class="sourceLine" id="cb60-11" title="11">        ) : (</a>
<a class="sourceLine" id="cb60-12" title="12">            <span class="op">&lt;</span>img src<span class="op">={</span>imgUrl<span class="op">}</span> alt<span class="op">={</span><span class="st">&quot;fund_logo&quot;</span><span class="op">}</span> className<span class="op">={</span><span class="vs">`w-1/2 h-1/2 </span><span class="sc">${</span>isActive <span class="op">!==</span> name <span class="op">&amp;&amp;</span> <span class="st">&#39;grayscale&#39;</span><span class="sc">}</span><span class="vs">`</span><span class="op">}</span>  /&gt; </a>
<a class="sourceLine" id="cb60-13" title="13">        )<span class="op">}</span></a>
<a class="sourceLine" id="cb60-14" title="14">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-15" title="15">)</a>
<a class="sourceLine" id="cb60-16" title="16"></a>
<a class="sourceLine" id="cb60-17" title="17"><span class="kw">const</span> Sidebar <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb60-18" title="18">    <span class="kw">const</span> navigate <span class="op">=</span> <span class="at">useNavigate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb60-19" title="19">  <span class="kw">const</span> [isActive<span class="op">,</span> setIsActive] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;dashboard&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb60-20" title="20">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb60-21" title="21">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex justify-between items-center flex-col sticky top-5 h-[93vh] &quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-22" title="22">        <span class="op">&lt;</span>Link to<span class="op">=</span><span class="st">&quot;/&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-23" title="23">         <span class="op">&lt;</span>Icon styles<span class="op">=</span><span class="st">&quot; w-[52px] h-[52px] bg-secondary&quot;</span> imgUrl<span class="op">={</span>logo<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb60-24" title="24">        &lt;/Link<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-25" title="25">        <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex-1 flex flex-col justify-between items-center bg-secondary rounded-[20px] w-[76px] py-4 mt-12&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-26" title="26">        <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex flex-col justify-center items-center gap-3&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-27" title="27">          <span class="op">{</span><span class="va">navlinks</span>.<span class="at">map</span>((link) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb60-28" title="28">            <span class="op">&lt;</span>Icon </a>
<a class="sourceLine" id="cb60-29" title="29">              key<span class="op">={</span><span class="va">link</span>.<span class="at">name</span><span class="op">}</span></a>
<a class="sourceLine" id="cb60-30" title="30">              <span class="op">{</span>...<span class="at">link</span><span class="op">}</span></a>
<a class="sourceLine" id="cb60-31" title="31">              isActive<span class="op">={</span>isActive<span class="op">}</span></a>
<a class="sourceLine" id="cb60-32" title="32">              handleClick<span class="op">={</span>() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb60-33" title="33">                <span class="cf">if</span>(<span class="op">!</span><span class="va">link</span>.<span class="at">disabled</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb60-34" title="34">                  <span class="at">setIsActive</span>(<span class="va">link</span>.<span class="at">name</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb60-35" title="35">                  <span class="at">navigate</span>(<span class="va">link</span>.<span class="at">link</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb60-36" title="36">                <span class="op">}</span></a>
<a class="sourceLine" id="cb60-37" title="37">              <span class="op">}}</span></a>
<a class="sourceLine" id="cb60-38" title="38">            /&gt;</a>
<a class="sourceLine" id="cb60-39" title="39">          ))<span class="op">}</span></a>
<a class="sourceLine" id="cb60-40" title="40">        &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-41" title="41">            <span class="op">&lt;</span>Icon styles<span class="op">=</span><span class="st">&quot;bg-secondary&quot;</span> imgUrl<span class="op">={</span>sun<span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb60-42" title="42">        &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-43" title="43">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb60-44" title="44">  )</a>
<a class="sourceLine" id="cb60-45" title="45"><span class="op">}</span></a>
<a class="sourceLine" id="cb60-46" title="46"></a>
<a class="sourceLine" id="cb60-47" title="47"><span class="im">export</span> <span class="im">default</span> Sidebar</a></code></pre></div>
<p>Before we go further with Navbar.jsx we need to create a new component called CustomButton.jsx in the components folder and past this code, save it.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb61-1" title="1"><span class="im">import</span> React <span class="im">from</span> <span class="st">&#39;react&#39;</span></a>
<a class="sourceLine" id="cb61-2" title="2"></a>
<a class="sourceLine" id="cb61-3" title="3"><span class="kw">const</span> CustomButton <span class="op">=</span> (<span class="op">{</span>btnType<span class="op">,</span> title<span class="op">,</span> handleclick<span class="op">,</span> styles <span class="op">}</span>) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb61-4" title="4">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb61-5" title="5">    <span class="op">&lt;</span>button</a>
<a class="sourceLine" id="cb61-6" title="6">      type<span class="op">={</span>btnType<span class="op">}</span></a>
<a class="sourceLine" id="cb61-7" title="7">      className<span class="op">={</span><span class="vs">`font-epilogue font-semibold text-[16px] leading-[26px] text-nine min-h-[52px] px-4 rounded-[20px] </span><span class="sc">${</span>styles<span class="sc">}</span><span class="vs">`</span><span class="op">}</span></a>
<a class="sourceLine" id="cb61-8" title="8">      onClick<span class="op">={</span>handleclick<span class="op">}</span></a>
<a class="sourceLine" id="cb61-9" title="9">    <span class="op">&gt;</span></a>
<a class="sourceLine" id="cb61-10" title="10">      <span class="op">{</span>title<span class="op">}</span></a>
<a class="sourceLine" id="cb61-11" title="11">    &lt;/button<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb61-12" title="12">    </a>
<a class="sourceLine" id="cb61-13" title="13">  )</a>
<a class="sourceLine" id="cb61-14" title="14"><span class="op">}</span></a>
<a class="sourceLine" id="cb61-15" title="15"></a>
<a class="sourceLine" id="cb61-16" title="16"><span class="im">export</span> <span class="im">default</span> CustomButton</a>
<a class="sourceLine" id="cb61-17" title="17">  </a></code></pre></div>
<p>Now we can open the index.js file in the components folder and add the following code:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb62-1" title="1"><span class="im">export</span> <span class="op">{</span><span class="im">default</span> <span class="im">as</span> CustomButton<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./CustomButton&#39;</span><span class="op">;</span></a></code></pre></div>
<p>so we can now safely move to our Navbar.jsx file in the component folder and add the following code:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb63-1" title="1"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span>useState<span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-2" title="2"><span class="im">import</span> <span class="op">{</span> Link<span class="op">,</span> useNavigate <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react-router-dom&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-3" title="3"><span class="im">import</span> <span class="op">{</span> CustomButton <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;./&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-4" title="4"><span class="im">import</span> <span class="op">{</span> logo<span class="op">,</span> menu<span class="op">,</span> search<span class="op">,</span> thirdweb<span class="op">,</span> old_profile <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../assets&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-5" title="5"><span class="im">import</span> <span class="op">{</span> navlinks <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;../constants&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb63-6" title="6"></a>
<a class="sourceLine" id="cb63-7" title="7"></a>
<a class="sourceLine" id="cb63-8" title="8"><span class="kw">const</span> Navbar <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-9" title="9">  <span class="kw">const</span> navigate <span class="op">=</span> <span class="at">useNavigate</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb63-10" title="10">  <span class="kw">const</span> [isActive<span class="op">,</span> setIsActive] <span class="op">=</span> <span class="at">useState</span>(<span class="st">&#39;dashboard&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-11" title="11">  <span class="kw">const</span> [toggleDrawer<span class="op">,</span> setToggleDrawer] <span class="op">=</span> <span class="at">useState</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-12" title="12">  <span class="kw">const</span> address<span class="op">=</span><span class="st">&#39;0x123ff112&#39;</span></a>
<a class="sourceLine" id="cb63-13" title="13"></a>
<a class="sourceLine" id="cb63-14" title="14"></a>
<a class="sourceLine" id="cb63-15" title="15">  <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb63-16" title="16">    <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex md:flex-row flex-col-reverse justify-between mb-[35px] gap-6&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-17" title="17">      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;lg:flex-1 flex flex-row max-w-[458px] py-2 pl-4 pr-2 h-[52px] bg-secondary rounded-[100px]&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-18" title="18">      <span class="op">&lt;</span>input type<span class="op">=</span><span class="st">&quot;text&quot;</span> placeholder<span class="op">=</span><span class="st">&quot;Search for campaigns&quot;</span> className<span class="op">=</span><span class="st">&quot;flex w-full font-epilogue font-normal text-[14px] placeholder:text-sixth text-third bg-transparent outline-none rounded-[100px]&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb63-19" title="19">        <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;w-[72px] h-full rounded-[20px] bg-fourth flex justify-center items-center cursor-pointer &quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-20" title="20">          <span class="op">&lt;</span>img src<span class="op">={</span>search<span class="op">}</span> alt<span class="op">=</span><span class="st">&quot;search&quot;</span> className<span class="op">=</span><span class="st">&quot;w-[15px] h-[15px] rounded-[10px] object-contain&quot;</span> /&gt;</a>
<a class="sourceLine" id="cb63-21" title="21">        &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-22" title="22">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-23" title="23">      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;sm:flex hidden flex-row justify-end gap-4&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-24" title="24">        <span class="op">&lt;</span>CustomButton </a>
<a class="sourceLine" id="cb63-25" title="25">          btnType<span class="op">=</span><span class="st">&quot;button&quot;</span></a>
<a class="sourceLine" id="cb63-26" title="26">          title<span class="op">={</span> address <span class="op">?</span> <span class="st">&#39;create campaign&#39;</span> : <span class="st">&#39;connect wallet&#39;</span><span class="op">}</span>  </a>
<a class="sourceLine" id="cb63-27" title="27">          styles<span class="op">={</span>address <span class="op">?</span> <span class="st">&#39;bg-fourth  text-nine&#39;</span> : <span class="st">&#39;bg-fourth text-[#FF0000]&#39;</span><span class="op">}</span> </a>
<a class="sourceLine" id="cb63-28" title="28">          handleClick<span class="op">={</span>() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-29" title="29">            <span class="cf">if</span>(address) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-30" title="30">              <span class="at">navigate</span>(<span class="st">&#39;/create-campaign&#39;</span>)</a>
<a class="sourceLine" id="cb63-31" title="31">            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-32" title="32">              <span class="st">&#39;connect()&#39;</span></a>
<a class="sourceLine" id="cb63-33" title="33">            <span class="op">}</span><span class="co">//fin else</span></a>
<a class="sourceLine" id="cb63-34" title="34">          <span class="op">}}</span></a>
<a class="sourceLine" id="cb63-35" title="35">        /&gt;</a>
<a class="sourceLine" id="cb63-36" title="36">        <span class="op">&lt;</span>Link to<span class="op">=</span><span class="st">&#39;/profile&#39;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-37" title="37">          <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&#39;w-[52px] h-[52px] rounded-full flex justify-center items-center bg-secondary cursor-pointer &#39;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-38" title="38">            <span class="op">&lt;</span>img src<span class="op">={</span>old_profile<span class="op">}</span> alt<span class="op">=</span><span class="st">&quot;&quot;</span> className<span class="op">=</span><span class="st">&#39;grayscale&#39;</span> /&gt;</a>
<a class="sourceLine" id="cb63-39" title="39">          &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-40" title="40">        &lt;/Link<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-41" title="41">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-42" title="42">      <span class="op">{</span><span class="co">/* small screen nav*/</span><span class="op">}</span></a>
<a class="sourceLine" id="cb63-43" title="43">      <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;sm:hidden flex flex-row justify-between items-center relative&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-44" title="44">          <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&#39;w-[40px] h-[40px] rounded-[10px] flex justify-center items-center bg-secondary cursor-pointer &#39;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-45" title="45">            <span class="op">&lt;</span>img src<span class="op">={</span>old_profile<span class="op">}</span> alt<span class="op">=</span><span class="st">&quot;&quot;</span> className<span class="op">=</span><span class="st">&#39;grayscale&#39;</span>/&gt;</a>
<a class="sourceLine" id="cb63-46" title="46">          &lt;/div<span class="op">&gt;</span>  </a>
<a class="sourceLine" id="cb63-47" title="47">          <span class="op">&lt;</span>img </a>
<a class="sourceLine" id="cb63-48" title="48">            src<span class="op">={</span>menu<span class="op">}</span></a>
<a class="sourceLine" id="cb63-49" title="49">            alt<span class="op">=</span><span class="st">&quot;menu&quot;</span></a>
<a class="sourceLine" id="cb63-50" title="50">            className<span class="op">=</span><span class="st">&#39;w-[34px] h-[34px] object-contain cursor-pointer&#39;</span></a>
<a class="sourceLine" id="cb63-51" title="51">            onClick<span class="op">={</span>() <span class="kw">=&gt;</span> <span class="at">setToggleDrawer</span>((prev) <span class="kw">=&gt;</span> <span class="op">!</span>prev)<span class="op">}</span></a>
<a class="sourceLine" id="cb63-52" title="52">          /&gt;</a>
<a class="sourceLine" id="cb63-53" title="53"></a>
<a class="sourceLine" id="cb63-54" title="54">          <span class="op">&lt;</span>div className<span class="op">={</span><span class="vs">`absolute top-[60px] right-0 left-0 bg-secondary z-10 shadow-primary py-4 </span><span class="sc">${</span><span class="op">!</span>toggleDrawer <span class="op">?</span> <span class="st">&#39;-translate-y-[100vh]&#39;</span> : <span class="st">&#39;translate-y-0&#39;</span><span class="sc">}</span><span class="vs">   transition-all duration-700`</span><span class="op">}</span> <span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-55" title="55">              <span class="op">&lt;</span>ul className<span class="op">=</span><span class="st">&#39;mb-4&#39;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-56" title="56">                 <span class="op">{</span><span class="va">navlinks</span>.<span class="at">map</span>((Link) <span class="kw">=&gt;</span> (</a>
<a class="sourceLine" id="cb63-57" title="57">                  <span class="op">&lt;</span>li </a>
<a class="sourceLine" id="cb63-58" title="58">                  key<span class="op">={</span><span class="va">Link</span>.<span class="at">name</span><span class="op">}</span> </a>
<a class="sourceLine" id="cb63-59" title="59">                  className<span class="op">={</span><span class="vs">`flex p-4 </span><span class="sc">${</span>isActive <span class="op">===</span> <span class="va">Link</span>.<span class="at">name</span> <span class="op">&amp;&amp;</span> <span class="st">&#39;bg-primary&#39;</span><span class="sc">}</span><span class="vs">`</span><span class="op">}</span> </a>
<a class="sourceLine" id="cb63-60" title="60">                  onClick<span class="op">={</span>() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-61" title="61">                    <span class="at">setIsActive</span>(<span class="va">Link</span>.<span class="at">name</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-62" title="62">                    <span class="at">setToggleDrawer</span>(<span class="kw">false</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-63" title="63">                    <span class="at">navigate</span>(<span class="va">Link</span>.<span class="at">link</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb63-64" title="64">  </a>
<a class="sourceLine" id="cb63-65" title="65">                  <span class="op">}}</span></a>
<a class="sourceLine" id="cb63-66" title="66">                <span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-67" title="67">                  <span class="op">&lt;</span>img</a>
<a class="sourceLine" id="cb63-68" title="68">                    src<span class="op">={</span><span class="va">Link</span>.<span class="at">imgUrl</span><span class="op">}</span></a>
<a class="sourceLine" id="cb63-69" title="69">                    alt<span class="op">={</span><span class="va">Link</span>.<span class="at">name</span><span class="op">}</span></a>
<a class="sourceLine" id="cb63-70" title="70">                    className<span class="op">={</span><span class="vs">`w-[24px] h-[24px] object-contain </span><span class="sc">${</span>isActive <span class="op">===</span> <span class="va">Link</span>.<span class="at">name</span> <span class="op">?</span> <span class="st">&#39;grayscale-0&#39;</span> : <span class="st">&#39;grayscale&#39;</span><span class="sc">}</span><span class="vs"> `</span><span class="op">}</span></a>
<a class="sourceLine" id="cb63-71" title="71">                  /&gt;</a>
<a class="sourceLine" id="cb63-72" title="72">                  <span class="op">&lt;</span>p className<span class="op">={</span><span class="vs">`ml-[20px] font-epilogue font-semibold text-[14px] </span><span class="sc">${</span>isActive <span class="op">===</span> <span class="va">Link</span>.<span class="at">name</span> <span class="op">?</span> <span class="st">&#39;text-nine&#39;</span> : <span class="st">&#39;text-sixth&#39;</span><span class="sc">}</span><span class="vs">  `</span><span class="op">}&gt;</span></a>
<a class="sourceLine" id="cb63-73" title="73">                    <span class="op">{</span><span class="va">Link</span>.<span class="at">name</span><span class="op">}</span></a>
<a class="sourceLine" id="cb63-74" title="74">                  &lt;/p<span class="op">&gt;</span>  </a>
<a class="sourceLine" id="cb63-75" title="75">                &lt;/li<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-76" title="76">                  ))<span class="op">}</span></a>
<a class="sourceLine" id="cb63-77" title="77">              &lt;/ul<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-78" title="78">              <span class="op">&lt;</span>div className<span class="op">=</span><span class="st">&quot;flex mx-4&quot;</span><span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-79" title="79">              <span class="op">&lt;</span>CustomButton </a>
<a class="sourceLine" id="cb63-80" title="80">                btnType<span class="op">=</span><span class="st">&quot;button&quot;</span></a>
<a class="sourceLine" id="cb63-81" title="81">                title<span class="op">={</span> address <span class="op">?</span> <span class="st">&#39;create campaign&#39;</span> : <span class="st">&#39;connect wallet&#39;</span><span class="op">}</span>  </a>
<a class="sourceLine" id="cb63-82" title="82">                styles<span class="op">={</span>address <span class="op">?</span> <span class="st">&#39;bg-fourth  text-nine&#39;</span> : <span class="st">&#39;bg-fourth text-[#FF0000]&#39;</span><span class="op">}</span> </a>
<a class="sourceLine" id="cb63-83" title="83">                handleClick<span class="op">={</span>() <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-84" title="84">                <span class="cf">if</span>(address) <span class="op">{</span></a>
<a class="sourceLine" id="cb63-85" title="85">                  <span class="at">navigate</span>(<span class="st">&#39;/create-campaign&#39;</span>)</a>
<a class="sourceLine" id="cb63-86" title="86">                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb63-87" title="87">                  <span class="st">&#39;connect()&#39;</span></a>
<a class="sourceLine" id="cb63-88" title="88">                <span class="op">}</span><span class="co">//fin else</span></a>
<a class="sourceLine" id="cb63-89" title="89">                 <span class="op">}}</span></a>
<a class="sourceLine" id="cb63-90" title="90">              /&gt;</a>
<a class="sourceLine" id="cb63-91" title="91">              &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-92" title="92">          &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-93" title="93"></a>
<a class="sourceLine" id="cb63-94" title="94">      &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-95" title="95"></a>
<a class="sourceLine" id="cb63-96" title="96">    &lt;/div<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb63-97" title="97">  )</a>
<a class="sourceLine" id="cb63-98" title="98"><span class="op">}</span></a>
<a class="sourceLine" id="cb63-99" title="99"></a>
<a class="sourceLine" id="cb63-100" title="100"><span class="im">export</span> <span class="im">default</span> Navbar</a></code></pre></div>
<p>So now we can take a look at our app..</p>
<p><img src="./images/applooknavbar1.png" alt="image" /><img src="./images/applooknavbar2.png" alt="image" /></p>
<h2 id="author-bio">Author bio</h2>
<p>Hi there, my name is Tim and I’m a computer programmer and herbalist. Just like Obélix fell into the magic potion when he was a kid, I fell into computer tech when I was just 9 years old. Ever since then, I’ve been hooked on all things tech-related. My friends know me as a good listener and a very calm person who is skilled at finding creative solutions to any problem.</p>
<p>I specialize in web development and server management, and I’m proficient in web3 technologies such as blockchain, smart contracts, and decentralized applications. I’m also well-versed in programming languages such as PHP, HTML/CSS, JS, and Solidity. In addition to fixing bugs and providing technical support, I am trained in computer science and have a keen eye for analyzing and improving upon projects.</p>
<p>If you’ve got a website or a web3 project that needs some TLC or a brand new one that needs to be built from scratch, don’t hesitate to hit me up. I’m here to help with my technical skills and my friendly, caring personality. I’m an honest and patient guy, and my motto is “listen more than you speak.” I love understanding and assisting others, and I’m always ready with a joke or two to lighten the mood. Let’s work together and make magic happen!</p>
<p>If this tutorial was helpful, please consider donating to the author. Your support is 10xgreatly appreciated and <strong>really needed!</strong></p>
<p>Eth address : 0xB486FFe5127dACCC9957715E7585A730622a28bc</p>
<p>or</p>
<p><a href="https://paypal.me/anonoil">https://paypal.me/anonoil</a></p>
<p>Again thank you for considering any support you can give me, each donation is counted and appreciated.</p>
<p>Also thank you for reading so far and I hope you enjoyed this tutorial. If you have any questions or suggestions, please feel free to leave a comment at tim@1proamonservice.eu. I will be happy to answer them.</p>
</body>
</html>
